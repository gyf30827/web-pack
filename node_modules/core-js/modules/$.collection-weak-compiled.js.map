{"version":3,"sources":["$.collection-weak.js"],"names":[],"mappings":"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","file":"$.collection-weak-compiled.js","sourcesContent":["'use strict';\nvar hide              = require('./$.hide')\n  , redefineAll       = require('./$.redefine-all')\n  , anObject          = require('./$.an-object')\n  , isObject          = require('./$.is-object')\n  , strictNew         = require('./$.strict-new')\n  , forOf             = require('./$.for-of')\n  , createArrayMethod = require('./$.array-methods')\n  , $has              = require('./$.has')\n  , WEAK              = require('./$.uid')('weak')\n  , isExtensible      = Object.isExtensible || isObject\n  , arrayFind         = createArrayMethod(5)\n  , arrayFindIndex    = createArrayMethod(6)\n  , id                = 0;\n\n// fallback for frozen keys\nvar frozenStore = function(that){\n  return that._l || (that._l = new FrozenStore);\n};\nvar FrozenStore = function(){\n  this.a = [];\n};\nvar findFrozen = function(store, key){\n  return arrayFind(store.a, function(it){\n    return it[0] === key;\n  });\n};\nFrozenStore.prototype = {\n  get: function(key){\n    var entry = findFrozen(this, key);\n    if(entry)return entry[1];\n  },\n  has: function(key){\n    return !!findFrozen(this, key);\n  },\n  set: function(key, value){\n    var entry = findFrozen(this, key);\n    if(entry)entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function(key){\n    var index = arrayFindIndex(this.a, function(it){\n      return it[0] === key;\n    });\n    if(~index)this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){\n    var C = wrapper(function(that, iterable){\n      strictNew(that, C, NAME);\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for frozen objects\n      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this)['delete'](key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i) && delete key[WEAK][this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this).has(key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i);\n      }\n    });\n    return C;\n  },\n  def: function(that, key, value){\n    if(!isExtensible(anObject(key))){\n      frozenStore(that).set(key, value);\n    } else {\n      $has(key, WEAK) || hide(key, WEAK, {});\n      key[WEAK][that._i] = value;\n    } return that;\n  },\n  frozenStore: frozenStore,\n  WEAK: WEAK\n};"]}