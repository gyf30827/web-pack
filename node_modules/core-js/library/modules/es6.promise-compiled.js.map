{"version":3,"sources":["es6.promise.js"],"names":[],"mappings":"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","file":"es6.promise-compiled.js","sourcesContent":["'use strict';\nvar $          = require('./$')\n  , LIBRARY    = require('./$.library')\n  , global     = require('./$.global')\n  , ctx        = require('./$.ctx')\n  , classof    = require('./$.classof')\n  , $export    = require('./$.export')\n  , isObject   = require('./$.is-object')\n  , anObject   = require('./$.an-object')\n  , aFunction  = require('./$.a-function')\n  , strictNew  = require('./$.strict-new')\n  , forOf      = require('./$.for-of')\n  , setProto   = require('./$.set-proto').set\n  , same       = require('./$.same-value')\n  , SPECIES    = require('./$.wks')('species')\n  , speciesConstructor = require('./$.species-constructor')\n  , asap       = require('./$.microtask')\n  , PROMISE    = 'Promise'\n  , process    = global.process\n  , isNode     = classof(process) == 'process'\n  , P          = global[PROMISE]\n  , empty      = function(){ /* empty */ }\n  , Wrapper;\n\nvar testResolve = function(sub){\n  var test = new P(empty), promise;\n  if(sub)test.constructor = function(exec){\n    exec(empty, empty);\n  };\n  (promise = P.resolve(test))['catch'](empty);\n  return promise === test;\n};\n\nvar USE_NATIVE = function(){\n  var works = false;\n  function P2(x){\n    var self = new P(x);\n    setProto(self, P2.prototype);\n    return self;\n  }\n  try {\n    works = P && P.resolve && testResolve();\n    setProto(P2, P);\n    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});\n    // actual Firefox has broken subclass support, test that\n    if(!(P2.resolve(5).then(function(){}) instanceof P2)){\n      works = false;\n    }\n    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162\n    if(works && require('./$.descriptors')){\n      var thenableThenGotten = false;\n      P.resolve($.setDesc({}, 'then', {\n        get: function(){ thenableThenGotten = true; }\n      }));\n      works = thenableThenGotten;\n    }\n  } catch(e){ works = false; }\n  return works;\n}();\n\n// helpers\nvar sameConstructor = function(a, b){\n  // library wrapper special case\n  if(LIBRARY && a === P && b === Wrapper)return true;\n  return same(a, b);\n};\nvar getConstructor = function(C){\n  var S = anObject(C)[SPECIES];\n  return S != undefined ? S : C;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar PromiseCapability = function(C){\n  var resolve, reject;\n  this.promise = new C(function($$resolve, $$reject){\n    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject  = $$reject;\n  });\n  this.resolve = aFunction(resolve),\n  this.reject  = aFunction(reject)\n};\nvar perform = function(exec){\n  try {\n    exec();\n  } catch(e){\n    return {error: e};\n  }\n};\nvar notify = function(record, isReject){\n  if(record.n)return;\n  record.n = true;\n  var chain = record.c;\n  asap(function(){\n    var value = record.v\n      , ok    = record.s == 1\n      , i     = 0;\n    var run = function(reaction){\n      var handler = ok ? reaction.ok : reaction.fail\n        , resolve = reaction.resolve\n        , reject  = reaction.reject\n        , result, then;\n      try {\n        if(handler){\n          if(!ok)record.h = true;\n          result = handler === true ? value : handler(value);\n          if(result === reaction.promise){\n            reject(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(result)){\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch(e){\n        reject(e);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    chain.length = 0;\n    record.n = false;\n    if(isReject)setTimeout(function(){\n      var promise = record.p\n        , handler, console;\n      if(isUnhandled(promise)){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      } record.a = undefined;\n    }, 1);\n  });\n};\nvar isUnhandled = function(promise){\n  var record = promise._d\n    , chain  = record.a || record.c\n    , i      = 0\n    , reaction;\n  if(record.h)return false;\n  while(chain.length > i){\n    reaction = chain[i++];\n    if(reaction.fail || !isUnhandled(reaction.promise))return false;\n  } return true;\n};\nvar $reject = function(value){\n  var record = this;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  record.v = value;\n  record.s = 2;\n  record.a = record.c.slice();\n  notify(record, true);\n};\nvar $resolve = function(value){\n  var record = this\n    , then;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  try {\n    if(record.p === value)throw TypeError(\"Promise can't be resolved itself\");\n    if(then = isThenable(value)){\n      asap(function(){\n        var wrapper = {r: record, d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      record.v = value;\n      record.s = 1;\n      notify(record, false);\n    }\n  } catch(e){\n    $reject.call({r: record, d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!USE_NATIVE){\n  // 25.4.3.1 Promise(executor)\n  P = function Promise(executor){\n    aFunction(executor);\n    var record = this._d = {\n      p: strictNew(this, P, PROMISE),         // <- promise\n      c: [],                                  // <- awaiting reactions\n      a: undefined,                           // <- checked in isUnhandled reactions\n      s: 0,                                   // <- state\n      d: false,                               // <- done\n      v: undefined,                           // <- value\n      h: false,                               // <- handled rejection\n      n: false                                // <- notify\n    };\n    try {\n      executor(ctx($resolve, record, 1), ctx($reject, record, 1));\n    } catch(err){\n      $reject.call(record, err);\n    }\n  };\n  require('./$.redefine-all')(P.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var reaction = new PromiseCapability(speciesConstructor(this, P))\n        , promise  = reaction.promise\n        , record   = this._d;\n      reaction.ok   = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      record.c.push(reaction);\n      if(record.a)record.a.push(reaction);\n      if(record.s)notify(record, false);\n      return promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: P});\nrequire('./$.set-to-string-tag')(P, PROMISE);\nrequire('./$.set-species')(PROMISE);\nWrapper = require('./$.core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    var capability = new PromiseCapability(this)\n      , $$reject   = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (!USE_NATIVE || testResolve(true)), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    // instanceof instead of internal slot check because we should fix it without replacement native Promise core\n    if(x instanceof P && sameConstructor(x.constructor, this))return x;\n    var capability = new PromiseCapability(this)\n      , $$resolve  = capability.resolve;\n    $$resolve(x);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./$.iter-detect')(function(iter){\n  P.all(iter)['catch'](function(){});\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , resolve    = capability.resolve\n      , reject     = capability.reject\n      , values     = [];\n    var abrupt = perform(function(){\n      forOf(iterable, false, values.push, values);\n      var remaining = values.length\n        , results   = Array(remaining);\n      if(remaining)$.each.call(values, function(promise, index){\n        var alreadyCalled = false;\n        C.resolve(promise).then(function(value){\n          if(alreadyCalled)return;\n          alreadyCalled = true;\n          results[index] = value;\n          --remaining || resolve(results);\n        }, reject);\n      });\n      else resolve(results);\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  }\n});"]}