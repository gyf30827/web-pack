{"version":3,"sources":["tokenchain.js"],"names":[],"mappings":"AAAA;;AAEA,SAAS,MAAT,GAAkB,CACjB;;AAED,OAAO,SAAP,CAAiB,IAAjB,GAAwB,UAAS,MAAT,EAAiB,SAAjB,EAA4B;AAClD,cAAY,aAAa,CAAzB;AACA,OAAK,IAAI,IAAI,CAAR,EAAW,MAAM,KAAK,IAAL,CAAU,MAAhC,EAAwC,IAAI,GAA5C,EAAiD,GAAjD,EAAsD;AACpD,QAAI,MAAM,KAAK,IAAL,CAAU,CAAV,CAAV;AACA,QAAI,QAAQ,IAAI,KAAJ,CAAU,CAAV,CAAZ;AACA,QAAI,QAAQ,OAAO,OAAP,CAAe,KAAf,EAAsB,SAAtB,CAAZ;AACA,QAAI,UAAU,CAAC,CAAf,EAAkB;AAChB,SAAG;AACD,YAAI,UAAU,SAAd,EAAyB;AACvB,iBAAO,MAAP,CAAc,KAAd,EAAqB,CAArB;AACA,iBAAO,MAAP,CAAc,SAAd,EAAyB,CAAzB,EAA4B,KAA5B;AACD;AACD;AACD,OAND,QAMS,CAAC,QAAQ,OAAO,OAAP,CAAe,KAAf,EAAsB,SAAtB,CAAT,MAA+C,CAAC,CANzD;AAOA,aAAO,KAAK,GAAL,EAAU,IAAV,CAAe,MAAf,EAAuB,SAAvB,CAAP;AACD;AACF;AACD,SAAO,MAAP;AACD,CAlBD;;AAoBA,SAAS,UAAT,GAAsB,CACrB;;AAED,WAAW,SAAX,GAAuB;AACrB,OAAK,UAAS,MAAT,EAAiB;AACpB,QAAI,OAAO,IAAX;AACA,WAAO,OAAP,CAAe,UAAS,KAAT,EAAgB;AAC7B,UAAI,MAAM,MAAM,KAAhB;AACA,UAAI,CAAC,KAAK,GAAL,CAAL,EAAgB;AACd,aAAK,GAAL,IAAY,EAAZ;AACA,aAAK,GAAL,EAAU,SAAV,GAAsB,CAAtB;AACD;AACD,WAAK,GAAL,EAAU,IAAV,CAAe,MAAf;AACD,KAPD;AAQD,GAXoB;AAYrB,gBAAc,YAAW;AACvB,QAAI,OAAO,IAAX;AACA,QAAI,SAAS,IAAI,MAAJ,EAAb;AACA,WAAO,IAAP,GAAc,OAAO,IAAP,CAAY,IAAZ,EAAkB,IAAlB,CAAuB,UAAS,CAAT,EAAY,CAAZ,EAAe;AAClD,UAAI,IAAI,KAAK,CAAL,EAAQ,MAAhB;AACA,UAAI,IAAI,KAAK,CAAL,EAAQ,MAAhB;AACA,aAAO,IAAI,CAAJ,GAAQ,CAAR,GAAY,IAAI,CAAJ,GAAQ,CAAC,CAAT,GAAa,IAAI,CAAJ,GAAQ,CAAC,CAAT,GAAa,IAAI,CAAJ,GAAQ,CAAR,GAAY,CAAzD;AACD,KAJa,EAIX,MAJW,CAIJ,UAAS,GAAT,EAAc;AACtB,UAAI,KAAK,GAAL,EAAU,SAAV,GAAsB,KAAK,GAAL,EAAU,MAApC,EAA4C;AAC1C,YAAI,QAAQ,IAAI,KAAJ,CAAU,CAAV,CAAZ;AACA,YAAI,QAAQ,IAAI,UAAJ,EAAZ;AACA,aAAK,GAAL,EAAU,OAAV,CAAkB,UAAS,MAAT,EAAiB;AACjC,cAAI,KAAJ;AACA,iBAAO,CAAC,QAAQ,OAAO,OAAP,CAAe,KAAf,CAAT,MAAoC,CAAC,CAA5C,EAA+C;AAC7C,mBAAO,MAAP,CAAc,KAAd,EAAqB,CAArB;AACD;AACD,iBAAO,OAAP,CAAe,UAAS,KAAT,EAAgB;AAC7B,iBAAK,MAAM,KAAX,EAAkB,SAAlB;AACD,WAFD;AAGA,gBAAM,GAAN,CAAU,OAAO,KAAP,CAAa,CAAb,CAAV;AACD,SATD;AAUA,eAAO,GAAP,IAAc,MAAM,YAAN,EAAd;AACA,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD,KAtBa,CAAd;AAuBA,WAAO,MAAP;AACD;AAvCoB,CAAvB;;AA0CA,OAAO,OAAP,GAAiB,UAAjB","file":"tokenchain-compiled.js","sourcesContent":["'use strict';\n\nfunction Sorter() {\n}\n\nSorter.prototype.sort = function(tokens, fromIndex) {\n  fromIndex = fromIndex || 0;\n  for (var i = 0, len = this.keys.length; i < len; i++) {\n    var key = this.keys[i];\n    var token = key.slice(1);\n    var index = tokens.indexOf(token, fromIndex);\n    if (index !== -1) {\n      do {\n        if (index !== fromIndex) {\n          tokens.splice(index, 1);\n          tokens.splice(fromIndex, 0, token);\n        }\n        fromIndex++;\n      } while ((index = tokens.indexOf(token, fromIndex)) !== -1);\n      return this[key].sort(tokens, fromIndex);\n    }\n  }\n  return tokens;\n};\n\nfunction TokenChain() {\n}\n\nTokenChain.prototype = {\n  add: function(tokens) {\n    var self = this;\n    tokens.forEach(function(token) {\n      var key = '$' + token;\n      if (!self[key]) {\n        self[key] = [];\n        self[key].processed = 0;\n      }\n      self[key].push(tokens);\n    });\n  },\n  createSorter: function() {\n    var self = this;\n    var sorter = new Sorter();\n    sorter.keys = Object.keys(self).sort(function(j, k) {\n      var m = self[j].length;\n      var n = self[k].length;\n      return m < n ? 1 : m > n ? -1 : j < k ? -1 : j > k ? 1 : 0;\n    }).filter(function(key) {\n      if (self[key].processed < self[key].length) {\n        var token = key.slice(1);\n        var chain = new TokenChain();\n        self[key].forEach(function(tokens) {\n          var index;\n          while ((index = tokens.indexOf(token)) !== -1) {\n            tokens.splice(index, 1);\n          }\n          tokens.forEach(function(token) {\n            self['$' + token].processed++;\n          });\n          chain.add(tokens.slice(0));\n        });\n        sorter[key] = chain.createSorter();\n        return true;\n      }\n      return false;\n    });\n    return sorter;\n  }\n};\n\nmodule.exports = TokenChain;\n"]}