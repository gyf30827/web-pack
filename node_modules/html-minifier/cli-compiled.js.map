{"version":3,"sources":["cli.js"],"names":[],"mappings":";AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;;AAEA,IAAI,YAAY,QAAQ,YAAR,CAAhB;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,gBAAR,CAAX;AACA,IAAI,SAAS,QAAQ,OAAO,KAAK,IAApB,EAA0B,MAAvC;AACA,IAAI,YAAY,QAAQ,YAAR,CAAhB;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,UAAU,QAAQ,WAAR,CAAd;;AAEA,QAAQ,KAAR,GAAgB,KAAK,IAArB;AACA,QAAQ,OAAR,CAAgB,KAAK,OAArB;;AAEA,SAAS,KAAT,CAAe,OAAf,EAAwB;AACtB,UAAQ,KAAR,CAAc,OAAd;AACA,UAAQ,IAAR,CAAa,CAAb;AACD;;AAED;;;;;;;;;;;;;;;;;;AAkBA,SAAS,WAAT,CAAqB,KAArB,EAA4B;AAC1B,MAAI,KAAJ,EAAW;AACT,WAAO,IAAI,MAAJ,CAAW,MAAM,OAAN,CAAc,YAAd,EAA4B,IAA5B,CAAX,CAAP;AACD;AACF;;AAED,SAAS,SAAT,CAAmB,KAAnB,EAA0B;AACxB,MAAI,KAAJ,EAAW;AACT,QAAI;AACF,aAAO,KAAK,KAAL,CAAW,KAAX,CAAP;AACD,KAFD,CAGA,OAAO,CAAP,EAAU;AACR,UAAI,KAAK,IAAL,CAAU,KAAV,CAAJ,EAAsB;AACpB,cAAM,kCAAkC,KAAlC,GAA0C,IAAhD;AACD;AACD,aAAO,KAAP;AACD;AACF;AACF;;AAED,SAAS,cAAT,CAAwB,KAAxB,EAA+B;AAC7B,MAAI,KAAJ,EAAW;AACT,YAAQ,UAAU,KAAV,CAAR;AACA,WAAO,MAAM,OAAN,CAAc,KAAd,IAAuB,KAAvB,GAA+B,CAAC,KAAD,CAAtC;AACD;AACF;;AAED,SAAS,oBAAT,CAA8B,KAA9B,EAAqC;AACnC,UAAQ,eAAe,KAAf,CAAR;AACA,SAAO,SAAS,MAAM,GAAN,CAAU,WAAV,CAAhB;AACD;;AAED,SAAS,WAAT,CAAqB,KAArB,EAA4B;AAC1B,SAAO,KAAP;AACD;;AAED,IAAI,cAAc;AAChB,iBAAe,0EADC;AAEhB,6BAA2B,+CAFX;AAGhB,+BAA6B,wCAHb;AAIhB,sBAAoB,yEAJJ;AAKhB,wBAAsB,uDALN;AAMhB,oBAAkB,CAAC,gIAAD,EAAmI,oBAAnI,CANF;AAOhB,sBAAoB,CAAC,gFAAD,EAAmF,WAAnF,CAPJ;AAQhB,sBAAoB,CAAC,sIAAD,EAAyI,oBAAzI,CARJ;AAShB,yBAAuB,CAAC,gGAAD,EAAmG,oBAAnG,CATP;AAUhB,kBAAgB,iDAVA;AAWhB,SAAO,+CAXS;AAYhB,wBAAsB,CAAC,wEAAD,EAA2E,oBAA3E,CAZN;AAahB,yBAAuB,CAAC,wGAAD,EAA2G,oBAA3G,CAbP;AAchB,4BAA0B,sCAdV;AAehB,oBAAkB,+CAfF;AAgBhB,iBAAe,CAAC,iBAAD,EAAoB,QAApB,CAhBC;AAiBhB,aAAW,CAAC,oEAAD,EAAuE,SAAvE,CAjBK;AAkBhB,YAAU,CAAC,0EAAD,EAA6E,SAA7E,CAlBM;AAmBhB,cAAY,CAAC,oDAAD,EAAuD,SAAvD,CAnBI;AAoBhB,sBAAoB,+GApBJ;AAqBhB,6BAA2B,oDArBX;AAsBhB,8BAA4B,2DAtBZ;AAuBhB,kBAAgB,CAAC,sJAAD,EAAyJ,cAAzJ,CAvBA;AAwBhB,kBAAgB,CAAC,qDAAD,EAAwD,WAAxD,CAxBA;AAyBhB,yBAAuB,gDAzBP;AA0BhB,kBAAgB,qBA1BA;AA2BhB,yBAAuB,mDA3BP;AA4BhB,uBAAqB,yCA5BL;AA6BhB,sBAAoB,wBA7BJ;AA8BhB,6BAA2B,+CA9BX;AA+BhB,8BAA4B,8FA/BZ;AAgChB,iCAA+B,+FAhCf;AAiChB,uBAAqB,mDAjCL;AAkChB,kBAAgB,8BAlCA;AAmChB,iBAAe,iCAnCC;AAoChB,uBAAqB,gDApCL;AAqChB,mBAAiB;AArCD,CAAlB;AAuCA,IAAI,iBAAiB,OAAO,IAAP,CAAY,WAAZ,CAArB;AACA,eAAe,OAAf,CAAuB,UAAS,GAAT,EAAc;AACnC,MAAI,SAAS,YAAY,GAAZ,CAAb;AACA,QAAM,OAAO,UAAU,GAAV,CAAb;AACA,MAAI,MAAM,OAAN,CAAc,MAAd,CAAJ,EAA2B;AACzB,QAAI,WAAW,OAAO,CAAP,MAAc,SAA7B;AACA,YAAQ,MAAR,CAAe,OAAO,WAAW,UAAX,GAAwB,UAA/B,CAAf,EAA2D,OAAO,CAAP,CAA3D,EAAsE,OAAO,CAAP,CAAtE;AACD,GAHD,MAIK;AACH,YAAQ,MAAR,CAAe,GAAf,EAAoB,MAApB;AACD;AACF,CAVD;AAWA,QAAQ,MAAR,CAAe,oBAAf,EAAqC,uEAArC;;AAEA,SAAS,QAAT,CAAkB,IAAlB,EAAwB;AACtB,MAAI;AACF,WAAO,GAAG,YAAH,CAAgB,IAAhB,EAAsB,EAAE,UAAU,MAAZ,EAAtB,CAAP;AACD,GAFD,CAGA,OAAO,CAAP,EAAU;AACR,UAAM,iBAAiB,IAAjB,GAAwB,IAAxB,GAA+B,EAAE,OAAvC;AACD;AACF;;AAED,IAAI,SAAS,EAAb;AACA,QAAQ,MAAR,CAAe,yBAAf,EAA0C,iBAA1C,EAA6D,UAAS,UAAT,EAAqB;AAChF,MAAI,OAAO,SAAS,UAAT,CAAX;AACA,MAAI;AACF,aAAS,KAAK,KAAL,CAAW,IAAX,CAAT;AACD,GAFD,CAGA,OAAO,EAAP,EAAW;AACT,QAAI;AACF,eAAS,QAAQ,KAAK,OAAL,CAAa,UAAb,CAAR,CAAT;AACD,KAFD,CAGA,OAAO,EAAP,EAAW;AACT,YAAM,sDAAsD,GAAG,OAAzD,GAAmE,eAAnE,GAAqF,GAAG,OAA9F;AACD;AACF;AACD,iBAAe,OAAf,CAAuB,UAAS,GAAT,EAAc;AACnC,QAAI,OAAO,MAAX,EAAmB;AACjB,UAAI,SAAS,YAAY,GAAZ,CAAb;AACA,UAAI,MAAM,OAAN,CAAc,MAAd,CAAJ,EAA2B;AACzB,YAAI,QAAQ,OAAO,GAAP,CAAZ;AACA,eAAO,GAAP,IAAc,OAAO,CAAP,EAAU,OAAO,KAAP,KAAiB,QAAjB,GAA4B,KAA5B,GAAoC,KAAK,SAAL,CAAe,KAAf,CAA9C,CAAd;AACD;AACF;AACF,GARD;AASD,CAtBD;AAuBA,QAAQ,MAAR,CAAe,mBAAf,EAAoC,4BAApC;AACA,QAAQ,MAAR,CAAe,oBAAf,EAAqC,6BAArC;AACA,QAAQ,MAAR,CAAe,mBAAf,EAAoC,2CAApC;AACA,IAAI,OAAJ;AACA,QAAQ,SAAR,CAAkB,YAAlB,EAAgC,MAAhC,CAAuC,UAAS,KAAT,EAAgB;AACrD,YAAU,MAAM,GAAN,CAAU,QAAV,EAAoB,IAApB,CAAyB,EAAzB,CAAV;AACD,CAFD,EAEG,KAFH,CAES,QAAQ,IAFjB;;AAIA,SAAS,aAAT,GAAyB;AACvB,MAAI,UAAU,EAAd;AACA,iBAAe,OAAf,CAAuB,UAAS,GAAT,EAAc;AACnC,QAAI,QAAQ,QAAQ,UAAU,GAAV,CAAR,CAAZ;AACA,QAAI,OAAO,KAAP,KAAiB,WAArB,EAAkC;AAChC,cAAQ,GAAR,IAAe,KAAf;AACD,KAFD,MAGK,IAAI,OAAO,MAAX,EAAmB;AACtB,cAAQ,GAAR,IAAe,OAAO,GAAP,CAAf;AACD;AACF,GARD;AASA,SAAO,OAAP;AACD;;AAED,SAAS,KAAT,CAAe,SAAf,EAA0B,QAA1B,EAAoC;AAClC,KAAG,KAAH,CAAS,SAAT,EAAoB,UAAS,GAAT,EAAc;AAChC,QAAI,GAAJ,EAAS;AACP,cAAQ,IAAI,IAAZ;AACE,aAAK,QAAL;AACE,iBAAO,MAAM,KAAK,IAAL,CAAU,SAAV,EAAqB,IAArB,CAAN,EAAkC,YAAW;AAClD,kBAAM,SAAN,EAAiB,QAAjB;AACD,WAFM,CAAP;AAGF,aAAK,QAAL;AACE;AACF;AACE,gBAAM,6BAA6B,SAA7B,GAAyC,IAAzC,GAAgD,IAAI,OAA1D;AARJ;AAUD;AACD;AACD,GAdD;AAeD;;AAED,SAAS,WAAT,CAAqB,SAArB,EAAgC,UAAhC,EAA4C;AAC1C,KAAG,QAAH,CAAY,SAAZ,EAAuB,EAAE,UAAU,MAAZ,EAAvB,EAA6C,UAAS,GAAT,EAAc,IAAd,EAAoB;AAC/D,QAAI,GAAJ,EAAS;AACP,YAAM,iBAAiB,SAAjB,GAA6B,IAA7B,GAAoC,IAAI,OAA9C;AACD;AACD,QAAI,QAAJ;AACA,QAAI;AACF,iBAAW,OAAO,IAAP,EAAa,eAAb,CAAX;AACD,KAFD,CAGA,OAAO,CAAP,EAAU;AACR,YAAM,2BAA2B,SAA3B,GAAuC,IAAvC,GAA8C,EAAE,OAAtD;AACD;AACD,OAAG,SAAH,CAAa,UAAb,EAAyB,QAAzB,EAAmC,EAAE,UAAU,MAAZ,EAAnC,EAAyD,UAAS,GAAT,EAAc;AACrE,UAAI,GAAJ,EAAS;AACP,cAAM,kBAAkB,UAAlB,GAA+B,IAA/B,GAAsC,IAAI,OAAhD;AACD;AACF,KAJD;AAKD,GAhBD;AAiBD;;AAED,SAAS,gBAAT,CAA0B,QAA1B,EAAoC,SAApC,EAA+C,OAA/C,EAAwD;AACtD,KAAG,OAAH,CAAW,QAAX,EAAqB,UAAS,GAAT,EAAc,KAAd,EAAqB;AACxC,QAAI,GAAJ,EAAS;AACP,YAAM,2BAA2B,QAA3B,GAAsC,IAAtC,GAA6C,IAAI,OAAvD;AACD;AACD,UAAM,OAAN,CAAc,UAAS,IAAT,EAAe;AAC3B,UAAI,YAAY,KAAK,IAAL,CAAU,QAAV,EAAoB,IAApB,CAAhB;AACA,UAAI,aAAa,KAAK,IAAL,CAAU,SAAV,EAAqB,IAArB,CAAjB;AACA,SAAG,IAAH,CAAQ,SAAR,EAAmB,UAAS,GAAT,EAAc,IAAd,EAAoB;AACrC,YAAI,GAAJ,EAAS;AACP,gBAAM,iBAAiB,SAAjB,GAA6B,IAA7B,GAAoC,IAAI,OAA9C;AACD,SAFD,MAGK,IAAI,KAAK,WAAL,EAAJ,EAAwB;AAC3B,2BAAiB,SAAjB,EAA4B,UAA5B,EAAwC,OAAxC;AACD,SAFI,MAGA,IAAI,CAAC,OAAD,IAAY,KAAK,OAAL,CAAa,IAAb,MAAuB,MAAM,OAA7C,EAAsD;AACzD,gBAAM,SAAN,EAAiB,YAAW;AAC1B,wBAAY,SAAZ,EAAuB,UAAvB;AACD,WAFD;AAGD;AACF,OAZD;AAaD,KAhBD;AAiBD,GArBD;AAsBD;;AAED,SAAS,WAAT,GAAuB;AACrB,MAAI,QAAJ;AACA,MAAI;AACF,eAAW,OAAO,OAAP,EAAgB,eAAhB,CAAX;AACD,GAFD,CAGA,OAAO,CAAP,EAAU;AACR,UAAM,0BAA0B,EAAE,OAAlC;AACD;AACD,GAAC,QAAQ,MAAR,GAAiB,GAAG,iBAAH,CAAqB,QAAQ,MAA7B,EAAqC,EAArC,CAAwC,OAAxC,EAAiD,UAAS,CAAT,EAAY;AAC7E,UAAM,kBAAkB,QAAQ,MAA1B,GAAmC,IAAnC,GAA0C,EAAE,OAAlD;AACD,GAFiB,CAAjB,GAEI,QAAQ,MAFb,EAEqB,KAFrB,CAE2B,QAF3B;AAGD;;AAED,IAAI,WAAW,QAAQ,QAAvB;AACA,IAAI,YAAY,QAAQ,SAAxB;AACA,IAAI,UAAU,QAAQ,OAAtB;AACA,IAAI,YAAY,SAAhB,EAA2B;AACzB,MAAI,CAAC,QAAL,EAAe;AACb,UAAM,kHAAN;AACD,GAFD,MAGK,IAAI,CAAC,SAAL,EAAgB;AACnB,UAAM,kFAAN;AACD;AACD,mBAAiB,QAAjB,EAA2B,SAA3B,EAAsC,OAAtC;AACD;AACD;AATA,KAUK,IAAI,OAAO,OAAP,KAAmB,QAAvB,EAAiC;AACpC;AACD;AACD;AAHK,OAIA;AACH,gBAAU,EAAV;AACA,cAAQ,KAAR,CAAc,WAAd,CAA0B,MAA1B;AACA,cAAQ,KAAR,CAAc,EAAd,CAAiB,MAAjB,EAAyB,UAAS,IAAT,EAAe;AACtC,mBAAW,IAAX;AACD,OAFD,EAEG,EAFH,CAEM,KAFN,EAEa,WAFb;AAGD","file":"cli-compiled.js","sourcesContent":["\n/**\n * html-minifier CLI tool\n *\n * The MIT License (MIT)\n *\n *  Copyright (c) 2014-2016 Zoltan Frombach\n *\n *  Permission is hereby granted, free of charge, to any person obtaining a copy of\n *  this software and associated documentation files (the \"Software\"), to deal in\n *  the Software without restriction, including without limitation the rights to\n *  use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n *  the Software, and to permit persons to whom the Software is furnished to do so,\n *  subject to the following conditions:\n *\n *  The above copyright notice and this permission notice shall be included in all\n *  copies or substantial portions of the Software.\n *\n *  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n *  FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n *  COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n *  IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n *  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n *\n */\n\n'use strict';\n\nvar camelCase = require('camel-case');\nvar fs = require('fs');\nvar info = require('./package.json');\nvar minify = require('./' + info.main).minify;\nvar paramCase = require('param-case');\nvar path = require('path');\nvar program = require('commander');\n\nprogram._name = info.name;\nprogram.version(info.version);\n\nfunction fatal(message) {\n  console.error(message);\n  process.exit(1);\n}\n\n/**\n * JSON does not support regexes, so, e.g., JSON.parse() will not create\n * a RegExp from the JSON value `[ \"/matchString/\" ]`, which is\n * technically just an array containing a string that begins and end with\n * a forward slash. To get a RegExp from a JSON string, it must be\n * constructed explicitly in JavaScript.\n *\n * The likelihood of actually wanting to match text that is enclosed in\n * forward slashes is probably quite rare, so if forward slashes were\n * included in an argument that requires a regex, the user most likely\n * thought they were part of the syntax for specifying a regex.\n *\n * In the unlikely case that forward slashes are indeed desired in the\n * search string, the user would need to enclose the expression in a\n * second set of slashes:\n *\n *    --customAttrSrround \"[\\\"//matchString//\\\"]\"\n */\nfunction parseRegExp(value) {\n  if (value) {\n    return new RegExp(value.replace(/^\\/(.*)\\/$/, '$1'));\n  }\n}\n\nfunction parseJSON(value) {\n  if (value) {\n    try {\n      return JSON.parse(value);\n    }\n    catch (e) {\n      if (/^{/.test(value)) {\n        fatal('Could not parse JSON value \\'' + value + '\\'');\n      }\n      return value;\n    }\n  }\n}\n\nfunction parseJSONArray(value) {\n  if (value) {\n    value = parseJSON(value);\n    return Array.isArray(value) ? value : [value];\n  }\n}\n\nfunction parseJSONRegExpArray(value) {\n  value = parseJSONArray(value);\n  return value && value.map(parseRegExp);\n}\n\nfunction parseString(value) {\n  return value;\n}\n\nvar mainOptions = {\n  caseSensitive: 'Treat attributes in case sensitive manner (useful for SVG; e.g. viewBox)',\n  collapseBooleanAttributes: 'Omit attribute values from boolean attributes',\n  collapseInlineTagWhitespace: 'Collapse white space around inline tag',\n  collapseWhitespace: 'Collapse white space that contributes to text nodes in a document tree.',\n  conservativeCollapse: 'Always collapse to 1 space (never remove it entirely)',\n  customAttrAssign: ['Arrays of regex\\'es that allow to support custom attribute assign expressions (e.g. \\'<div flex?=\"{{mode != cover}}\"></div>\\')', parseJSONRegExpArray],\n  customAttrCollapse: ['Regex that specifies custom attribute to strip newlines from (e.g. /ng-class/)', parseRegExp],\n  customAttrSurround: ['Arrays of regex\\'es that allow to support custom attribute surround expressions (e.g. <input {{#if value}}checked=\"checked\"{{/if}}>)', parseJSONRegExpArray],\n  customEventAttributes: ['Arrays of regex\\'es that allow to support custom event attributes for minifyJS (e.g. ng-click)', parseJSONRegExpArray],\n  decodeEntities: 'Use direct Unicode characters whenever possible',\n  html5: 'Parse input according to HTML5 specifications',\n  ignoreCustomComments: ['Array of regex\\'es that allow to ignore certain comments, when matched', parseJSONRegExpArray],\n  ignoreCustomFragments: ['Array of regex\\'es that allow to ignore certain fragments, when matched (e.g. <?php ... ?>, {{ ... }})', parseJSONRegExpArray],\n  includeAutoGeneratedTags: 'Insert tags generated by HTML parser',\n  keepClosingSlash: 'Keep the trailing slash on singleton elements',\n  maxLineLength: ['Max line length', parseInt],\n  minifyCSS: ['Minify CSS in style elements and style attributes (uses clean-css)', parseJSON],\n  minifyJS: ['Minify Javascript in script elements and on* attributes (uses uglify-js)', parseJSON],\n  minifyURLs: ['Minify URLs in various attributes (uses relateurl)', parseJSON],\n  preserveLineBreaks: 'Always collapse to 1 line break (never remove it entirely) when whitespace between tags include a line break.',\n  preventAttributesEscaping: 'Prevents the escaping of the values of attributes.',\n  processConditionalComments: 'Process contents of conditional comments through minifier',\n  processScripts: ['Array of strings corresponding to types of script elements to process through minifier (e.g. \"text/ng-template\", \"text/x-handlebars-template\", etc.)', parseJSONArray],\n  quoteCharacter: ['Type of quote to use for attribute values (\\' or \")', parseString],\n  removeAttributeQuotes: 'Remove quotes around attributes when possible.',\n  removeComments: 'Strip HTML comments',\n  removeEmptyAttributes: 'Remove all attributes with whitespace-only values',\n  removeEmptyElements: 'Remove all elements with empty contents',\n  removeOptionalTags: 'Remove unrequired tags',\n  removeRedundantAttributes: 'Remove attributes when value matches default.',\n  removeScriptTypeAttributes: 'Remove type=\"text/javascript\" from script tags. Other type attribute values are left intact.',\n  removeStyleLinkTypeAttributes: 'Remove type=\"text/css\" from style and link tags. Other type attribute values are left intact.',\n  removeTagWhitespace: 'Remove space between attributes whenever possible',\n  sortAttributes: 'Sort attributes by frequency',\n  sortClassName: 'Sort style classes by frequency',\n  trimCustomFragments: 'Trim white space around ignoreCustomFragments.',\n  useShortDoctype: 'Replaces the doctype with the short (HTML5) doctype'\n};\nvar mainOptionKeys = Object.keys(mainOptions);\nmainOptionKeys.forEach(function(key) {\n  var option = mainOptions[key];\n  key = '--' + paramCase(key);\n  if (Array.isArray(option)) {\n    var optional = option[1] === parseJSON;\n    program.option(key + (optional ? ' [value]' : ' <value>'), option[0], option[1]);\n  }\n  else {\n    program.option(key, option);\n  }\n});\nprogram.option('-o --output <file>', 'Specify output file (if not specified STDOUT will be used for output)');\n\nfunction readFile(file) {\n  try {\n    return fs.readFileSync(file, { encoding: 'utf8' });\n  }\n  catch (e) {\n    fatal('Cannot read ' + file + '\\n' + e.message);\n  }\n}\n\nvar config = {};\nprogram.option('-c --config-file <file>', 'Use config file', function(configPath) {\n  var data = readFile(configPath);\n  try {\n    config = JSON.parse(data);\n  }\n  catch (je) {\n    try {\n      config = require(path.resolve(configPath));\n    }\n    catch (ne) {\n      fatal('Cannot read the specified config file.\\nAs JSON: ' + je.message + '\\nAs module: ' + ne.message);\n    }\n  }\n  mainOptionKeys.forEach(function(key) {\n    if (key in config) {\n      var option = mainOptions[key];\n      if (Array.isArray(option)) {\n        var value = config[key];\n        config[key] = option[1](typeof value === 'string' ? value : JSON.stringify(value));\n      }\n    }\n  });\n});\nprogram.option('--input-dir <dir>', 'Specify an input directory');\nprogram.option('--output-dir <dir>', 'Specify an output directory');\nprogram.option('--file-ext <text>', 'Specify an extension to be read, ex: html');\nvar content;\nprogram.arguments('[files...]').action(function(files) {\n  content = files.map(readFile).join('');\n}).parse(process.argv);\n\nfunction createOptions() {\n  var options = {};\n  mainOptionKeys.forEach(function(key) {\n    var param = program[camelCase(key)];\n    if (typeof param !== 'undefined') {\n      options[key] = param;\n    }\n    else if (key in config) {\n      options[key] = config[key];\n    }\n  });\n  return options;\n}\n\nfunction mkdir(outputDir, callback) {\n  fs.mkdir(outputDir, function(err) {\n    if (err) {\n      switch (err.code) {\n        case 'ENOENT':\n          return mkdir(path.join(outputDir, '..'), function() {\n            mkdir(outputDir, callback);\n          });\n        case 'EEXIST':\n          break;\n        default:\n          fatal('Cannot create directory ' + outputDir + '\\n' + err.message);\n      }\n    }\n    callback();\n  });\n}\n\nfunction processFile(inputFile, outputFile) {\n  fs.readFile(inputFile, { encoding: 'utf8' }, function(err, data) {\n    if (err) {\n      fatal('Cannot read ' + inputFile + '\\n' + err.message);\n    }\n    var minified;\n    try {\n      minified = minify(data, createOptions());\n    }\n    catch (e) {\n      fatal('Minification error on ' + inputFile + '\\n' + e.message);\n    }\n    fs.writeFile(outputFile, minified, { encoding: 'utf8' }, function(err) {\n      if (err) {\n        fatal('Cannot write ' + outputFile + '\\n' + err.message);\n      }\n    });\n  });\n}\n\nfunction processDirectory(inputDir, outputDir, fileExt) {\n  fs.readdir(inputDir, function(err, files) {\n    if (err) {\n      fatal('Cannot read directory ' + inputDir + '\\n' + err.message);\n    }\n    files.forEach(function(file) {\n      var inputFile = path.join(inputDir, file);\n      var outputFile = path.join(outputDir, file);\n      fs.stat(inputFile, function(err, stat) {\n        if (err) {\n          fatal('Cannot read ' + inputFile + '\\n' + err.message);\n        }\n        else if (stat.isDirectory()) {\n          processDirectory(inputFile, outputFile, fileExt);\n        }\n        else if (!fileExt || path.extname(file) === '.' + fileExt) {\n          mkdir(outputDir, function() {\n            processFile(inputFile, outputFile);\n          });\n        }\n      });\n    });\n  });\n}\n\nfunction writeMinify() {\n  var minified;\n  try {\n    minified = minify(content, createOptions());\n  }\n  catch (e) {\n    fatal('Minification error:\\n' + e.message);\n  }\n  (program.output ? fs.createWriteStream(program.output).on('error', function(e) {\n    fatal('Cannot write ' + program.output + '\\n' + e.message);\n  }) : process.stdout).write(minified);\n}\n\nvar inputDir = program.inputDir;\nvar outputDir = program.outputDir;\nvar fileExt = program.fileExt;\nif (inputDir || outputDir) {\n  if (!inputDir) {\n    fatal('The option output-dir needs to be used with the option input-dir. If you are working with a single file, use -o.');\n  }\n  else if (!outputDir) {\n    fatal('You need to specify where to write the output files with the option --output-dir');\n  }\n  processDirectory(inputDir, outputDir, fileExt);\n}\n// Minifying one or more files specified on the CMD line\nelse if (typeof content === 'string') {\n  writeMinify();\n}\n// Minifying input coming from STDIN\nelse {\n  content = '';\n  process.stdin.setEncoding('utf8');\n  process.stdin.on('data', function(data) {\n    content += data;\n  }).on('end', writeMinify);\n}\n"]}