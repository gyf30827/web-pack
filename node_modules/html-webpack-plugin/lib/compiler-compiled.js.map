{"version":3,"sources":["compiler.js"],"names":[],"mappings":"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","file":"compiler-compiled.js","sourcesContent":["/*\n * This file uses webpack to compile a template with a child compiler.\n *\n * [TEMPLATE] -> [JAVASCRIPT]\n *\n */\n'use strict';\nvar Promise = require('bluebird');\nvar _ = require('lodash');\nvar path = require('path');\nvar NodeTemplatePlugin = require('webpack/lib/node/NodeTemplatePlugin');\nvar NodeTargetPlugin = require('webpack/lib/node/NodeTargetPlugin');\nvar LoaderTargetPlugin = require('webpack/lib/LoaderTargetPlugin');\nvar LibraryTemplatePlugin = require('webpack/lib/LibraryTemplatePlugin');\nvar SingleEntryPlugin = require('webpack/lib/SingleEntryPlugin');\n\n/**\n * Compiles the template into a nodejs factory, adds its to the compilation.assets\n * and returns a promise of the result asset object.\n *\n * @param template relative path to the template file\n * @param context path context\n * @param outputFilename the file name\n * @param compilation The webpack compilation object\n *\n * Returns an object:\n * {\n *  hash: {String} - Base64 hash of the file\n *  content: {String} - Javascript executable code of the template\n * }\n *\n */\nmodule.exports.compileTemplate = function compileTemplate (template, context, outputFilename, compilation) {\n  // The entry file is just an empty helper as the dynamic template\n  // require is added in \"loader.js\"\n  var outputOptions = {\n    filename: outputFilename,\n    publicPath: compilation.outputOptions.publicPath\n  };\n  // Store the result of the parent compilation before we start the child compilation\n  var assetsBeforeCompilation = _.assign({}, compilation.assets[outputOptions.filename]);\n  // Create an additional child compiler which takes the template\n  // and turns it into an Node.JS html factory.\n  // This allows us to use loaders during the compilation\n  var compilerName = getCompilerName(context, outputFilename);\n  var childCompiler = compilation.createChildCompiler(compilerName, outputOptions);\n  childCompiler.context = context;\n  childCompiler.apply(\n    new NodeTemplatePlugin(outputOptions),\n    new NodeTargetPlugin(),\n    new LibraryTemplatePlugin('HTML_WEBPACK_PLUGIN_RESULT', 'var'),\n    new SingleEntryPlugin(this.context, template),\n    new LoaderTargetPlugin('node')\n  );\n\n  // Fix for \"Uncaught TypeError: __webpack_require__(...) is not a function\"\n  // Hot module replacement requires that every child compiler has its own\n  // cache. @see https://github.com/ampedandwired/html-webpack-plugin/pull/179\n  childCompiler.plugin('compilation', function (compilation) {\n    if (compilation.cache) {\n      if (!compilation.cache[compilerName]) {\n        compilation.cache[compilerName] = {};\n      }\n      compilation.cache = compilation.cache[compilerName];\n    }\n  });\n\n  // Compile and return a promise\n  return new Promise(function (resolve, reject) {\n    childCompiler.runAsChild(function (err, entries, childCompilation) {\n      // Resolve / reject the promise\n      if (childCompilation && childCompilation.errors && childCompilation.errors.length) {\n        var errorDetails = childCompilation.errors.map(function (error) {\n          return error.message + (error.error ? ':\\n' + error.error : '');\n        }).join('\\n');\n        reject(new Error('Child compilation failed:\\n' + errorDetails));\n      } else if (err) {\n        reject(err);\n      } else {\n        // Replace [hash] placeholders in filename\n        var outputName = compilation.mainTemplate.applyPluginsWaterfall('asset-path', outputOptions.filename, {\n          hash: childCompilation.hash,\n          chunk: entries[0]\n        });\n        // Restore the parent compilation to the state like it\n        // was before the child compilation\n        compilation.assets[outputName] = assetsBeforeCompilation[outputName];\n        if (assetsBeforeCompilation[outputName] === undefined) {\n          // If it wasn't there - delete it\n          delete compilation.assets[outputName];\n        }\n        resolve({\n          // Hash of the template entry point\n          hash: entries[0].hash,\n          // Output name\n          outputName: outputName,\n          // Compiled code\n          content: childCompilation.assets[outputName].source()\n        });\n      }\n    });\n  });\n};\n\n/**\n * Returns the child compiler name e.g. 'html-webpack-plugin for \"index.html\"'\n */\nfunction getCompilerName (context, filename) {\n  var absolutePath = path.resolve(context, filename);\n  var relativePath = path.relative(context, absolutePath);\n  return 'html-webpack-plugin for \"' + (absolutePath.length < relativePath.length ? absolutePath : relativePath) + '\"';\n}\n"]}