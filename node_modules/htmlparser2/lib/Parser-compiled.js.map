{"version":3,"sources":["Parser.js"],"names":[],"mappings":"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","file":"Parser-compiled.js","sourcesContent":["var Tokenizer = require(\"./Tokenizer.js\");\n\n/*\n\tOptions:\n\n\txmlMode: Special behavior for script/style tags (true by default)\n\tlowerCaseAttributeNames: call .toLowerCase for each attribute name (true if xmlMode is `false`)\n\tlowerCaseTags: call .toLowerCase for each tag name (true if xmlMode is `false`)\n*/\n\n/*\n\tCallbacks:\n\n\toncdataend,\n\toncdatastart,\n\tonclosetag,\n\toncomment,\n\toncommentend,\n\tonerror,\n\tonopentag,\n\tonprocessinginstruction,\n\tonreset,\n\tontext\n*/\n\nvar formTags = {\n\tinput: true,\n\toption: true,\n\toptgroup: true,\n\tselect: true,\n\tbutton: true,\n\tdatalist: true,\n\ttextarea: true\n};\n\nvar openImpliesClose = {\n\ttr      : { tr:true, th:true, td:true },\n\tth      : { th:true },\n\ttd      : { thead:true, td:true },\n\tbody    : { head:true, link:true, script:true },\n\tli      : { li:true },\n\tp       : { p:true },\n\tselect  : formTags,\n\tinput   : formTags,\n\toutput  : formTags,\n\tbutton  : formTags,\n\tdatalist: formTags,\n\ttextarea: formTags,\n\toption  : { option:true },\n\toptgroup: { optgroup:true }\n};\n\nvar voidElements = {\n\t__proto__: null,\n\tarea: true,\n\tbase: true,\n\tbasefont: true,\n\tbr: true,\n\tcol: true,\n\tcommand: true,\n\tembed: true,\n\tframe: true,\n\thr: true,\n\timg: true,\n\tinput: true,\n\tisindex: true,\n\tkeygen: true,\n\tlink: true,\n\tmeta: true,\n\tparam: true,\n\tsource: true,\n\ttrack: true,\n\twbr: true\n};\n\nvar re_nameEnd = /\\s|\\//;\n\nfunction Parser(cbs, options){\n\tthis._options = options || {};\n\tthis._cbs = cbs || {};\n\n\tthis._tagname = \"\";\n\tthis._attribname = \"\";\n\tthis._attribvalue = \"\";\n\tthis._attribs = null;\n\tthis._stack = [];\n\tthis._done = false;\n\n\tthis.startIndex = 0;\n\tthis.endIndex = null;\n\n\tthis._tokenizer = new Tokenizer(options, this);\n}\n\nrequire(\"util\").inherits(Parser, require(\"events\").EventEmitter);\n\nParser.prototype._updatePosition = function(initialOffset){\n\tif(this.endIndex === null){\n\t\tthis.startIndex = this._tokenizer._sectionStart <= initialOffset ? 0 : this._tokenizer._sectionStart - initialOffset;\n\t}\n\tthis.startIndex = this.endIndex + 1;\n\tthis.endIndex = this._tokenizer._index;\n};\n\n//Tokenizer event handlers\nParser.prototype.ontext = function(data){\n\tthis._updatePosition(1);\n\tthis.endIndex--;\n\n\tif(this._cbs.ontext) this._cbs.ontext(data);\n};\n\nParser.prototype.onopentagname = function(name){\n\tif(!(this._options.xmlMode || \"lowerCaseTags\" in this._options) || this._options.lowerCaseTags){\n\t\tname = name.toLowerCase();\n\t}\n\n\tthis._tagname = name;\n\n\tif (!this._options.xmlMode && name in openImpliesClose) {\n\t\tfor(\n\t\t\tvar el;\n\t\t\t(el = this._stack[this._stack.length-1]) in openImpliesClose[name];\n\t\t\tthis.onclosetag(el)\n\t\t);\n\t}\n\n\tif(this._options.xmlMode || !(name in voidElements)){\n\t\tthis._stack.push(name);\n\t}\n\n\tif(this._cbs.onopentagname) this._cbs.onopentagname(name);\n\tif(this._cbs.onopentag) this._attribs = {};\n};\n\nParser.prototype.onopentagend = function(){\n\tthis._updatePosition(1);\n    \n\tif(this._attribs){\n\t\tif(this._cbs.onopentag) this._cbs.onopentag(this._tagname, this._attribs);\n\t\tthis._attribs = null;\n\t}\n    \n\tif(!this._options.xmlMode && this._cbs.onclosetag && this._tagname in voidElements){\n\t\tthis._cbs.onclosetag(this._tagname);\n\t}\n    \n\tthis._tagname = \"\";\n};\n\nParser.prototype.onclosetag = function(name){\n\tthis._updatePosition(1);\n\n\tif(!(this._options.xmlMode || \"lowerCaseTags\" in this._options) || this._options.lowerCaseTags){\n\t\tname = name.toLowerCase();\n\t}\n\n\tif(this._stack.length && (!(name in voidElements) || this._options.xmlMode)){\n\t\tvar pos = this._stack.lastIndexOf(name);\n\t\tif(pos !== -1){\n\t\t\tif(this._cbs.onclosetag){\n\t\t\t\tpos = this._stack.length - pos;\n\t\t\t\twhile(pos--) this._cbs.onclosetag(this._stack.pop());\n\t\t\t}\n\t\t\telse this._stack.length = pos;\n\t\t} else if(name === \"p\" && !this._options.xmlMode){\n\t\t\tthis.onopentagname(name);\n\t\t\tthis._closeCurrentTag();\n\t\t}\n\t} else if(!this._options.xmlMode && (name === \"br\" || name === \"p\")){\n\t\tthis.onopentagname(name);\n\t\tthis._closeCurrentTag();\n\t}\n};\n\nParser.prototype.onselfclosingtag = function(){\n\tif(this._options.xmlMode){\n\t\tthis._closeCurrentTag();\n\t} else {\n\t\tthis.onopentagend();\n\t}\n};\n\nParser.prototype._closeCurrentTag = function(){\n\tvar name = this._tagname;\n\n\tthis.onopentagend();\n\n\t//self-closing tags will be on the top of the stack\n\t//(cheaper check than in onclosetag)\n\tif(this._stack[this._stack.length-1] === name){\n\t\tif(this._cbs.onclosetag){\n\t\t\tthis._cbs.onclosetag(name);\n\t\t}\n\t\tthis._stack.pop();\n\t}\n};\n\nParser.prototype.onattribname = function(name){\n\tif(!(this._options.xmlMode || \"lowerCaseAttributeNames\" in this._options) || this._options.lowerCaseAttributeNames){\n\t\tname = name.toLowerCase();\n\t}\n\tthis._attribname = name;\n};\n\nParser.prototype.onattribdata = function(value){\n\tthis._attribvalue += value;\n};\n\nParser.prototype.onattribend = function(){\n\tif(this._cbs.onattribute) this._cbs.onattribute(this._attribname, this._attribvalue);\n\tif(\n\t\tthis._attribs &&\n\t\t!Object.prototype.hasOwnProperty.call(this._attribs, this._attribname)\n\t){\n\t\tthis._attribs[this._attribname] = this._attribvalue;\n\t}\n\tthis._attribname = \"\";\n\tthis._attribvalue = \"\";\n};\n\nParser.prototype.ondeclaration = function(value){\n\tif(this._cbs.onprocessinginstruction){\n\t\tvar idx = value.search(re_nameEnd),\n\t\t    name = idx < 0 ? value : value.substr(0, idx);\n\n\t\tif(!(this._options.xmlMode || \"lowerCaseTags\" in this._options) || this._options.lowerCaseTags){\n\t\t\tname = name.toLowerCase();\n\t\t}\n\t\tthis._cbs.onprocessinginstruction(\"!\" + name, \"!\" + value);\n\t}\n};\n\nParser.prototype.onprocessinginstruction = function(value){\n\tif(this._cbs.onprocessinginstruction){\n\t\tvar idx = value.search(re_nameEnd),\n\t\t    name = idx < 0 ? value : value.substr(0, idx);\n\n\t\tif(!(this._options.xmlMode || \"lowerCaseTags\" in this._options) || this._options.lowerCaseTags){\n\t\t\tname = name.toLowerCase();\n\t\t}\n\t\tthis._cbs.onprocessinginstruction(\"?\" + name, \"?\" + value);\n\t}\n};\n\nParser.prototype.oncomment = function(value){\n\tthis._updatePosition(4);\n\n\tif(this._cbs.oncomment) this._cbs.oncomment(value);\n\tif(this._cbs.oncommentend) this._cbs.oncommentend();\n};\n\nParser.prototype.oncdata = function(value){\n\tthis._updatePosition(1);\n\n\tif(this._options.xmlMode){\n\t\tif(this._cbs.oncdatastart) this._cbs.oncdatastart();\n\t\tif(this._cbs.ontext) this._cbs.ontext(value);\n\t\tif(this._cbs.oncdataend) this._cbs.oncdataend();\n\t} else {\n\t\tthis.oncomment(\"[CDATA[\" + value + \"]]\");\n\t}\n};\n\nParser.prototype.onerror = function(err){\n\tif(this._cbs.onerror) this._cbs.onerror(err);\n};\n\nParser.prototype.onend = function(){\n\tif(this._cbs.onclosetag){\n\t\tfor(\n\t\t\tvar i = this._stack.length;\n\t\t\ti > 0;\n\t\t\tthis._cbs.onclosetag(this._stack[--i])\n\t\t);\n\t}\n\tif(this._cbs.onend) this._cbs.onend();\n};\n\n\n//Resets the parser to a blank state, ready to parse a new HTML document\nParser.prototype.reset = function(){\n\tif(this._cbs.onreset) this._cbs.onreset();\n\tthis._tokenizer.reset();\n\n\tthis._tagname = \"\";\n\tthis._attribname = \"\";\n\tthis._attribs = null;\n\tthis._stack = [];\n\tthis._done = false;\n};\n\n//Parses a complete HTML document and pushes it to the handler\nParser.prototype.parseComplete = function(data){\n\tthis.reset();\n\tthis.end(data);\n};\n\nParser.prototype.write = function(chunk){\n\tif(this._done) this.onerror(Error(\".write() after done!\"));\n\tthis._tokenizer.write(chunk);\n};\n\nParser.prototype.end = function(chunk){\n\tif(this._done) this.onerror(Error(\".end() after done!\"));\n\tthis._tokenizer.end(chunk);\n\tthis._done = true;\n};\n\n//alias for backwards compat\nParser.prototype.parseChunk = Parser.prototype.write;\nParser.prototype.done = Parser.prototype.end;\n\nmodule.exports = Parser;\n"]}