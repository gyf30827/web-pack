{"version":3,"sources":["FeedHandler.js"],"names":[],"mappings":"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","file":"FeedHandler-compiled.js","sourcesContent":["var index = require(\"./index.js\"),\n    DomHandler = index.DomHandler,\n\tDomUtils = index.DomUtils;\n\n//TODO: make this a streamable handler\nfunction FeedHandler(callback, options){\n\tthis.init(callback, options);\n}\n\nrequire(\"util\").inherits(FeedHandler, DomHandler);\n\nFeedHandler.prototype.init = DomHandler;\n\nfunction getElements(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true);\n}\nfunction getOneElement(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true, 1)[0];\n}\nfunction fetch(what, where, recurse){\n\treturn DomUtils.getText(\n\t\tDomUtils.getElementsByTagName(what, where, recurse, 1)\n\t).trim();\n}\n\nfunction addConditionally(obj, prop, what, where, recurse){\n\tvar tmp = fetch(what, where, recurse);\n\tif(tmp) obj[prop] = tmp;\n}\n\nvar isValidFeed = function(value) {\n\treturn value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n};\n\nFeedHandler.prototype.onend = function() {\n\tvar feed = {},\n\t\tfeedRoot = getOneElement(isValidFeed, this.dom),\n\t\ttmp, childs;\n\n\tif (feedRoot) {\n\t\tif(feedRoot.name === \"feed\"){\n\t\t\tchilds = feedRoot.children;\n\n\t\t\tfeed.type = \"atom\";\n\t\t\taddConditionally(feed, \"id\", \"id\", childs);\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\tif((tmp = getOneElement(\"link\", childs)) && (tmp = tmp.attribs) && (tmp = tmp.href)) feed.link = tmp;\n\t\t\taddConditionally(feed, \"description\", \"subtitle\", childs);\n\t\t\tif(tmp = fetch(\"updated\", childs)) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"email\", childs, true);\n\n\t\t\tfeed.items = getElements(\"entry\", childs).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"id\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\tif((tmp = getOneElement(\"link\", item)) && (tmp = tmp.attribs) && (tmp = tmp.href)) entry.link = tmp;\n\t\t\t\taddConditionally(entry, \"description\", \"summary\", item);\n\t\t\t\tif(tmp = fetch(\"updated\", item)) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t} else{\n\t\t\tchilds = getOneElement(\"channel\", feedRoot.children).children;\n\n\t\t\tfeed.type = feedRoot.name.substr(0, 3);\n\t\t\tfeed.id = \"\";\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\taddConditionally(feed, \"link\", \"link\", childs);\n\t\t\taddConditionally(feed, \"description\", \"description\", childs);\n\t\t\tif(tmp = fetch(\"lastBuildDate\", childs)) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"managingEditor\", childs, true);\n\n\t\t\tfeed.items = getElements(\"item\", feedRoot.children).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"guid\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\taddConditionally(entry, \"link\", \"link\", item);\n\t\t\t\taddConditionally(entry, \"description\", \"description\", item);\n\t\t\t\tif(tmp = fetch(\"pubDate\", item)) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t}\n\t}\n\tthis.dom = feed;\n\tDomHandler.prototype._handleCallback.call(\n\t\tthis, feedRoot ? null : Error(\"couldn't find root of feed\")\n\t);\n};\n\nmodule.exports = FeedHandler;\n"]}