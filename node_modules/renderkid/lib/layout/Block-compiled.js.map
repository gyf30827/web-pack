{"version":3,"sources":["Block.js"],"names":[],"mappings":"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","file":"Block-compiled.js","sourcesContent":["// Generated by CoffeeScript 1.9.3\nvar Block, SpecialString, object, terminalWidth;\n\nSpecialString = require('./SpecialString');\n\nobject = require('utila').object;\n\nterminalWidth = require('../tools').getCols();\n\nmodule.exports = Block = (function() {\n  var self;\n\n  self = Block;\n\n  Block.defaultConfig = {\n    blockPrependor: {\n      fn: require('./block/blockPrependor/Default'),\n      options: {\n        amount: 0\n      }\n    },\n    blockAppendor: {\n      fn: require('./block/blockAppendor/Default'),\n      options: {\n        amount: 0\n      }\n    },\n    linePrependor: {\n      fn: require('./block/linePrependor/Default'),\n      options: {\n        amount: 0\n      }\n    },\n    lineAppendor: {\n      fn: require('./block/lineAppendor/Default'),\n      options: {\n        amount: 0\n      }\n    },\n    lineWrapper: {\n      fn: require('./block/lineWrapper/Default'),\n      options: {\n        lineWidth: null\n      }\n    },\n    width: terminalWidth,\n    prefixRaw: '',\n    suffixRaw: ''\n  };\n\n  function Block(_layout, _parent, config, _name) {\n    this._layout = _layout;\n    this._parent = _parent;\n    if (config == null) {\n      config = {};\n    }\n    this._name = _name != null ? _name : '';\n    this._config = object.append(self.defaultConfig, config);\n    this._closed = false;\n    this._wasOpenOnce = false;\n    this._active = false;\n    this._buffer = '';\n    this._didSeparateBlock = false;\n    this._linePrependor = new this._config.linePrependor.fn(this._config.linePrependor.options);\n    this._lineAppendor = new this._config.lineAppendor.fn(this._config.lineAppendor.options);\n    this._blockPrependor = new this._config.blockPrependor.fn(this._config.blockPrependor.options);\n    this._blockAppendor = new this._config.blockAppendor.fn(this._config.blockAppendor.options);\n  }\n\n  Block.prototype._activate = function(deactivateParent) {\n    if (deactivateParent == null) {\n      deactivateParent = true;\n    }\n    if (this._active) {\n      throw Error(\"This block is already active. This is probably a bug in RenderKid itself\");\n    }\n    if (this._closed) {\n      throw Error(\"This block is closed and cannot be activated. This is probably a bug in RenderKid itself\");\n    }\n    this._active = true;\n    this._layout._activeBlock = this;\n    if (deactivateParent) {\n      if (this._parent != null) {\n        this._parent._deactivate(false);\n      }\n    }\n    return this;\n  };\n\n  Block.prototype._deactivate = function(activateParent) {\n    if (activateParent == null) {\n      activateParent = true;\n    }\n    this._ensureActive();\n    this._flushBuffer();\n    if (activateParent) {\n      if (this._parent != null) {\n        this._parent._activate(false);\n      }\n    }\n    this._active = false;\n    return this;\n  };\n\n  Block.prototype._ensureActive = function() {\n    if (!this._wasOpenOnce) {\n      throw Error(\"This block has never been open before. This is probably a bug in RenderKid itself.\");\n    }\n    if (!this._active) {\n      throw Error(\"This block is not active. This is probably a bug in RenderKid itself.\");\n    }\n    if (this._closed) {\n      throw Error(\"This block is already closed. This is probably a bug in RenderKid itself.\");\n    }\n  };\n\n  Block.prototype._open = function() {\n    if (this._wasOpenOnce) {\n      throw Error(\"Block._open() has been called twice. This is probably a RenderKid bug.\");\n    }\n    this._wasOpenOnce = true;\n    if (this._parent != null) {\n      this._parent.write(this._whatToPrependToBlock());\n    }\n    this._activate();\n    return this;\n  };\n\n  Block.prototype.close = function() {\n    this._deactivate();\n    this._closed = true;\n    if (this._parent != null) {\n      this._parent.write(this._whatToAppendToBlock());\n    }\n    return this;\n  };\n\n  Block.prototype.isOpen = function() {\n    return this._wasOpenOnce && !this._closed;\n  };\n\n  Block.prototype.write = function(str) {\n    this._ensureActive();\n    if (str === '') {\n      return;\n    }\n    str = String(str);\n    this._buffer += str;\n    return this;\n  };\n\n  Block.prototype.openBlock = function(config, name) {\n    var block;\n    this._ensureActive();\n    block = new Block(this._layout, this, config, name);\n    block._open();\n    return block;\n  };\n\n  Block.prototype._flushBuffer = function() {\n    var str;\n    if (this._buffer === '') {\n      return;\n    }\n    str = this._buffer;\n    this._buffer = '';\n    this._writeInline(str);\n  };\n\n  Block.prototype._toPrependToLine = function() {\n    var fromParent;\n    fromParent = '';\n    if (this._parent != null) {\n      fromParent = this._parent._toPrependToLine();\n    }\n    return this._linePrependor.render(fromParent);\n  };\n\n  Block.prototype._toAppendToLine = function() {\n    var fromParent;\n    fromParent = '';\n    if (this._parent != null) {\n      fromParent = this._parent._toAppendToLine();\n    }\n    return this._lineAppendor.render(fromParent);\n  };\n\n  Block.prototype._whatToPrependToBlock = function() {\n    return this._blockPrependor.render();\n  };\n\n  Block.prototype._whatToAppendToBlock = function() {\n    return this._blockAppendor.render();\n  };\n\n  Block.prototype._writeInline = function(str) {\n    var i, j, k, l, lineBreaksToAppend, m, ref, ref1, ref2, remaining;\n    if (SpecialString(str).isOnlySpecialChars()) {\n      this._layout._append(str);\n      return;\n    }\n    remaining = str;\n    lineBreaksToAppend = 0;\n    if (m = remaining.match(/^\\n+/)) {\n      for (i = j = 1, ref = m[0].length; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n        this._writeLine('');\n      }\n      remaining = remaining.substr(m[0].length, remaining.length);\n    }\n    if (m = remaining.match(/\\n+$/)) {\n      lineBreaksToAppend = m[0].length;\n      remaining = remaining.substr(0, remaining.length - m[0].length);\n    }\n    while (remaining.length > 0) {\n      if (m = remaining.match(/^[^\\n]+/)) {\n        this._writeLine(m[0]);\n        remaining = remaining.substr(m[0].length, remaining.length);\n      } else if (m = remaining.match(/^\\n+/)) {\n        for (i = k = 1, ref1 = m[0].length; 1 <= ref1 ? k < ref1 : k > ref1; i = 1 <= ref1 ? ++k : --k) {\n          this._writeLine('');\n        }\n        remaining = remaining.substr(m[0].length, remaining.length);\n      }\n    }\n    if (lineBreaksToAppend > 0) {\n      for (i = l = 1, ref2 = lineBreaksToAppend; 1 <= ref2 ? l <= ref2 : l >= ref2; i = 1 <= ref2 ? ++l : --l) {\n        this._writeLine('');\n      }\n    }\n  };\n\n  Block.prototype._writeLine = function(str) {\n    var line, lineContent, lineContentLength, remaining, roomLeft, toAppend, toAppendLength, toPrepend, toPrependLength;\n    remaining = SpecialString(str);\n    while (true) {\n      toPrepend = this._toPrependToLine();\n      toPrependLength = SpecialString(toPrepend).length;\n      toAppend = this._toAppendToLine();\n      toAppendLength = SpecialString(toAppend).length;\n      roomLeft = this._layout._config.terminalWidth - (toPrependLength + toAppendLength);\n      lineContentLength = Math.min(this._config.width, roomLeft);\n      lineContent = remaining.cut(0, lineContentLength, true);\n      line = toPrepend + lineContent.str + toAppend;\n      this._layout._appendLine(line);\n      if (remaining.isEmpty()) {\n        break;\n      }\n    }\n  };\n\n  return Block;\n\n})();\n"]}