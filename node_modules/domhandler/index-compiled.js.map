{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var ElementType = require(\"domelementtype\");\r\n\r\nvar re_whitespace = /\\s+/g;\r\n\r\nfunction DomHandler(callback, options, elementCB){\r\n\tif(typeof callback === \"object\"){\r\n\t\telementCB = options;\r\n\t\toptions = callback;\r\n\t\tcallback = null;\r\n\t} else if(typeof options === \"function\"){\r\n\t\telementCB = options;\r\n\t\toptions = defaultOpts;\r\n\t}\r\n\tthis._callback = callback;\r\n\tthis._options = options || defaultOpts;\r\n\tthis._elementCB = elementCB;\r\n\tthis.dom = [];\r\n\tthis._done = false;\r\n\tthis._tagStack = [];\r\n}\r\n\r\n//default options\r\nvar defaultOpts = {\r\n\tnormalizeWhitespace: false //Replace all whitespace with single spaces\r\n};\r\n\r\n//Resets the handler back to starting state\r\nDomHandler.prototype.onreset = function(){\r\n\tDomHandler.call(this, this._callback, this._options, this._elementCB);\r\n};\r\n\r\n//Signals the handler that parsing is done\r\nDomHandler.prototype.onend = function(){\r\n\tif(this._done) return;\r\n\tthis._done = true;\r\n\tthis._handleCallback(null);\r\n};\r\n\r\nDomHandler.prototype._handleCallback =\r\nDomHandler.prototype.onerror = function(error){\r\n\tif(typeof this._callback === \"function\"){\r\n\t\tthis._callback(error, this.dom);\r\n\t} else {\r\n\t\tif(error) throw error;\r\n\t}\r\n};\r\n\r\nDomHandler.prototype.onclosetag = function(name){\r\n\t//if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\r\n\tvar elem = this._tagStack.pop();\r\n\tif(this._elementCB) this._elementCB(elem);\r\n};\r\n\r\nDomHandler.prototype._addDomElement = function(element){\r\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\r\n\r\n\tif(lastTag){\r\n\t\tlastTag.children.push(element);\r\n\t} else { //There aren't parent elements\r\n\t\tthis.dom.push(element);\r\n\t}\r\n};\r\n\r\nDomHandler.prototype.onopentag = function(name, attribs){\r\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\r\n\r\n\tvar element = {\r\n\t\ttype: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\r\n\t\tname: name,\r\n\t\tattribs: attribs,\r\n\t\tchildren: [],\r\n\t\tprev: null,\r\n\t\tnext: null,\r\n\t\tparent: lastTag || null\r\n\t};\r\n\r\n\tif(lastTag){\r\n\t\tvar idx = lastTag.children.length;\r\n\t\twhile(idx > 0){\r\n\t\t\tif(ElementType.isTag(lastTag.children[--idx])){\r\n\t\t\t\telement.prev = lastTag.children[idx];\r\n\t\t\t\tlastTag.children[idx].next = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlastTag.children.push(element);\r\n\t} else {\r\n\t\tthis.dom.push(element);\r\n\t}\r\n\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.ontext = function(data){\r\n\t//the ignoreWhitespace is officially dropped, but for now,\r\n\t//it's an alias for normalizeWhitespace\r\n\tvar normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\r\n\r\n\tvar lastTag;\r\n\r\n\tif(!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length-1]).type === ElementType.Text){\r\n\t\tif(normalize){\r\n\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\r\n\t\t} else {\r\n\t\t\tlastTag.data += data;\r\n\t\t}\r\n\t} else {\r\n\t\tif(\r\n\t\t\tthis._tagStack.length &&\r\n\t\t\t(lastTag = this._tagStack[this._tagStack.length - 1]) &&\r\n\t\t\t(lastTag = lastTag.children[lastTag.children.length - 1]) &&\r\n\t\t\tlastTag.type === ElementType.Text\r\n\t\t){\r\n\t\t\tif(normalize){\r\n\t\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\r\n\t\t\t} else {\r\n\t\t\t\tlastTag.data += data;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(normalize){\r\n\t\t\t\tdata = data.replace(re_whitespace, \" \");\r\n\t\t\t}\r\n\r\n\t\t\tthis._addDomElement({\r\n\t\t\t\tdata: data,\r\n\t\t\t\ttype: ElementType.Text\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDomHandler.prototype.oncomment = function(data){\r\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\r\n\r\n\tif(lastTag && lastTag.type === ElementType.Comment){\r\n\t\tlastTag.data += data;\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar element = {\r\n\t\tdata: data,\r\n\t\ttype: ElementType.Comment\r\n\t};\r\n\r\n\tthis._addDomElement(element);\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.oncdatastart = function(){\r\n\tvar element = {\r\n\t\tchildren: [{\r\n\t\t\tdata: \"\",\r\n\t\t\ttype: ElementType.Text\r\n\t\t}],\r\n\t\ttype: ElementType.CDATA\r\n\t};\r\n\r\n\tthis._addDomElement(element);\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function(){\r\n\tthis._tagStack.pop();\r\n};\r\n\r\nDomHandler.prototype.onprocessinginstruction = function(name, data){\r\n\tthis._addDomElement({\r\n\t\tname: name,\r\n\t\tdata: data,\r\n\t\ttype: ElementType.Directive\r\n\t});\r\n};\r\n\r\nmodule.exports = DomHandler;"]}