{"version":3,"sources":["replace.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,WAAR,EAAqB,OAApC;;AAEA,IAAI,eAAe,oCAAnB;AACA,IAAI,mBAAmB,gBAAvB;;AAEA,SAAS,OAAT,CAAiB,GAAjB,EAAsB,IAAtB,EAA4B;AAC1B,MAAI,CAAC,aAAa,IAAb,CAAkB,GAAlB,CAAL,EAA6B;AAC3B,WAAO,GAAP;AACD;;AAED,MAAI,MAAM,EAAV;AACA,MAAI,QAAQ,KAAK,IAAL,CAAU,UAAS,GAAT,EAAc;AAClC,WAAO,IAAI,CAAJ,IAAS,IAAI,CAAJ,CAAM,OAAN,CAAc,OAAd,MAA2B,CAAC,CAA5C;AACD,GAFW,CAAZ;;AAIA,WAAS,SAAT,GAAqB,CAArB;AACA,MAAI,QAAQ,IAAI,KAAJ,CAAU,QAAV,CAAZ;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,MAAM,MAA1B,EAAkC,GAAlC,EAAuC;AACrC,QAAI,MAAM,CAAN,MAAiB,SAAjB,IACA,MAAM,IAAI,CAAV,MAAiB,GADjB,IAEA,MAAM,IAAI,CAAV,MAAiB,KAFjB,IAGA,MAAM,IAAI,CAAV,MAAiB,GAHrB,EAG0B;AACxB,UAAI,gBAAgB,qBAAqB,CAAC,CAAtB,EAAyB,KAAzB,EAAgC,CAAhC,CAApB;AACA,UAAI,gBAAgB,qBAAqB,CAArB,EAAwB,KAAxB,EAA+B,IAAI,CAAnC,CAApB;AACA,UAAI,cAAc,qBAAqB,IAArB,EAA2B,MAAM,IAAI,CAAV,CAA3B,EAAyC,KAAzC,CAAlB;AACA,UAAI,kBAAkB,GAAlB,IACA,kBAAkB,GADlB,IAEA,kBAAkB,GAFlB,IAGA,OAAO,WAAP,KAAuB,QAH3B,EAGqC;AACnC,YAAI,IAAJ,CAAS,WAAT;AACA,aAAK,CAAL;AACA;AACD;AACF;AACD,QAAI,IAAJ,CAAS,MAAM,CAAN,CAAT;AACD;;AAED,SAAO,IAAI,IAAJ,CAAS,EAAT,CAAP;AACD;;AAED,SAAS,oBAAT,CAA8B,GAA9B,EAAmC,KAAnC,EAA0C,CAA1C,EAA6C;AAC3C,SAAO,IAAP,EAAa;AACX,QAAI,OAAO,MAAM,KAAK,GAAX,CAAX;AACA,QAAI,CAAC,iBAAiB,IAAjB,CAAsB,IAAtB,CAAL,EAAkC;AAChC,aAAO,IAAP;AACD;AACF;AACF;;AAED,SAAS,oBAAT,CAA8B,IAA9B,EAAoC,IAApC,EAA0C,KAA1C,EAAiD;AAC/C,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AACpC,QAAI,MAAM,KAAK,CAAL,CAAV;AACA,QAAI,OAAO,IAAI,IAAJ,CAAP,KAAqB,WAAzB,EAAsC;AACpC,aAAO,KAAK,SAAL,CAAe,IAAI,IAAJ,CAAf,CAAP;AACD;AACF;AACD,MAAI,KAAJ,EAAW;AACT,WAAO,WAAP;AACD;AACF;;AAED,OAAO,OAAP,GAAiB,OAAjB","file":"replace-compiled.js","sourcesContent":["'use strict';\n\nvar jsTokens = require('js-tokens').default;\n\nvar processEnvRe = /\\bprocess\\.env\\.[_$a-zA-Z][$\\w]+\\b/;\nvar spaceOrCommentRe = /^(?:\\s|\\/[/*])/;\n\nfunction replace(src, envs) {\n  if (!processEnvRe.test(src)) {\n    return src;\n  }\n\n  var out = [];\n  var purge = envs.some(function(env) {\n    return env._ && env._.indexOf('purge') !== -1;\n  });\n\n  jsTokens.lastIndex = 0\n  var parts = src.match(jsTokens);\n\n  for (var i = 0; i < parts.length; i++) {\n    if (parts[i    ] === 'process' &&\n        parts[i + 1] === '.' &&\n        parts[i + 2] === 'env' &&\n        parts[i + 3] === '.') {\n      var prevCodeToken = getAdjacentCodeToken(-1, parts, i);\n      var nextCodeToken = getAdjacentCodeToken(1, parts, i + 4);\n      var replacement = getReplacementString(envs, parts[i + 4], purge);\n      if (prevCodeToken !== '.' &&\n          nextCodeToken !== '.' &&\n          nextCodeToken !== '=' &&\n          typeof replacement === 'string') {\n        out.push(replacement);\n        i += 4;\n        continue;\n      }\n    }\n    out.push(parts[i]);\n  }\n\n  return out.join('');\n}\n\nfunction getAdjacentCodeToken(dir, parts, i) {\n  while (true) {\n    var part = parts[i += dir];\n    if (!spaceOrCommentRe.test(part)) {\n      return part;\n    }\n  }\n}\n\nfunction getReplacementString(envs, name, purge) {\n  for (var j = 0; j < envs.length; j++) {\n    var env = envs[j];\n    if (typeof env[name] !== 'undefined') {\n      return JSON.stringify(env[name]);\n    }\n  }\n  if (purge) {\n    return 'undefined';\n  }\n}\n\nmodule.exports = replace;\n"]}