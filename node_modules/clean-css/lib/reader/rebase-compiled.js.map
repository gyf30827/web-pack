{"version":3,"sources":["rebase.js"],"names":[],"mappings":"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","file":"rebase-compiled.js","sourcesContent":["var extractImportUrlAndMedia = require('./extract-import-url-and-media');\nvar restoreImport = require('./restore-import');\nvar rewriteUrl = require('./rewrite-url');\n\nvar Token = require('../tokenizer/token');\nvar isImport = require('../utils/is-import');\n\nvar SOURCE_MAP_COMMENT_PATTERN = /^\\/\\*# sourceMappingURL=(\\S+) \\*\\/$/;\n\nfunction rebase(tokens, rebaseAll, validator, rebaseConfig) {\n  return rebaseAll ?\n    rebaseEverything(tokens, validator, rebaseConfig) :\n    rebaseAtRules(tokens, validator, rebaseConfig);\n}\n\nfunction rebaseEverything(tokens, validator, rebaseConfig) {\n  var token;\n  var i, l;\n\n  for (i = 0, l = tokens.length; i < l; i++) {\n    token = tokens[i];\n\n    switch (token[0]) {\n      case Token.AT_RULE:\n        rebaseAtRule(token, validator, rebaseConfig);\n        break;\n      case Token.AT_RULE_BLOCK:\n        rebaseProperties(token[2], validator, rebaseConfig);\n        break;\n      case Token.COMMENT:\n        rebaseSourceMapComment(token, rebaseConfig);\n        break;\n      case Token.NESTED_BLOCK:\n        rebaseEverything(token[2], validator, rebaseConfig);\n        break;\n      case Token.RULE:\n        rebaseProperties(token[2], validator, rebaseConfig);\n        break;\n    }\n  }\n\n  return tokens;\n}\n\nfunction rebaseAtRules(tokens, validator, rebaseConfig) {\n  var token;\n  var i, l;\n\n  for (i = 0, l = tokens.length; i < l; i++) {\n    token = tokens[i];\n\n    switch (token[0]) {\n      case Token.AT_RULE:\n        rebaseAtRule(token, validator, rebaseConfig);\n        break;\n    }\n  }\n\n  return tokens;\n}\n\nfunction rebaseAtRule(token, validator, rebaseConfig) {\n  if (!isImport(token[1])) {\n    return;\n  }\n\n  var uriAndMediaQuery = extractImportUrlAndMedia(token[1]);\n  var newUrl = rewriteUrl(uriAndMediaQuery[0], rebaseConfig);\n  var mediaQuery = uriAndMediaQuery[1];\n\n  token[1] = restoreImport(newUrl, mediaQuery);\n}\n\nfunction rebaseSourceMapComment(token, rebaseConfig) {\n  var matches = SOURCE_MAP_COMMENT_PATTERN.exec(token[1]);\n\n  if (matches && matches[1].indexOf('data:') === -1) {\n    token[1] = token[1].replace(matches[1], rewriteUrl(matches[1], rebaseConfig, true));\n  }\n}\n\nfunction rebaseProperties(properties, validator, rebaseConfig) {\n  var property;\n  var value;\n  var i, l;\n  var j, m;\n\n  for (i = 0, l = properties.length; i < l; i++) {\n    property = properties[i];\n\n    for (j = 2 /* 0 is Token.PROPERTY, 1 is name */, m = property.length; j < m; j++) {\n      value = property[j][1];\n\n      if (validator.isUrl(value)) {\n        property[j][1] = rewriteUrl(value, rebaseConfig);\n      }\n    }\n  }\n}\n\nmodule.exports = rebase;\n"]}