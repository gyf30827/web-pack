{"version":3,"sources":["load-original-sources.js"],"names":[],"mappings":"AAAA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA,IAAI,oBAAoB,QAAQ,uBAAR,CAAxB;;AAEA,IAAI,cAAc,QAAQ,uBAAR,CAAlB;AACA,IAAI,mBAAmB,QAAQ,6BAAR,CAAvB;;AAEA,SAAS,mBAAT,CAA6B,OAA7B,EAAsC,QAAtC,EAAgD;AAC9C,MAAI,cAAc;AAChB,cAAU,QADM;AAEhB,WAAO,QAAQ,OAAR,CAAgB,KAFP;AAGhB,WAAO,CAHS;AAIhB,YAAQ,QAAQ,OAAR,CAAgB,MAJR;AAKhB,mBAAe,QAAQ,OAAR,CAAgB,aALf;AAMhB,mBAAe,QAAQ,OAAR,CAAgB,aANf;AAOhB,eAAW,QAAQ,SAPH;AAQhB,cAAU,QAAQ,OAAR,CAAgB,QARV;AAShB,oBAAgB,QAAQ,cATR;AAUhB,iBAAa,mBAAmB,QAAQ,qBAAR,CAA8B,GAA9B,EAAnB,CAVG;AAWhB,cAAU,QAAQ;AAXF,GAAlB;;AAcA,SAAO,QAAQ,OAAR,CAAgB,SAAhB,IAA6B,QAAQ,OAAR,CAAgB,sBAA7C,GACL,sBAAsB,WAAtB,CADK,GAEL,UAFF;AAGD;;AAED,SAAS,kBAAT,CAA4B,qBAA5B,EAAmD;AACjD,MAAI,UAAU,EAAd;AACA,MAAI,QAAJ;AACA,MAAI,GAAJ;AACA,MAAI,MAAJ;AACA,MAAI,CAAJ,EAAO,CAAP;;AAEA,OAAK,MAAL,IAAe,qBAAf,EAAsC;AACpC,eAAW,sBAAsB,MAAtB,CAAX;;AAEA,SAAK,IAAI,CAAJ,EAAO,IAAI,SAAS,OAAT,CAAiB,MAAjC,EAAyC,IAAI,CAA7C,EAAgD,GAAhD,EAAqD;AACnD,YAAM,SAAS,OAAT,CAAiB,CAAjB,CAAN;AACA,eAAS,SAAS,gBAAT,CAA0B,GAA1B,EAA+B,IAA/B,CAAT;;AAEA,cAAQ,GAAR,IAAe,MAAf;AACD;AACF;;AAED,SAAO,OAAP;AACD;;AAED,SAAS,qBAAT,CAA+B,WAA/B,EAA4C;AAC1C,MAAI,OAAO,OAAO,IAAP,CAAY,YAAY,WAAxB,CAAX;AACA,MAAI,GAAJ;AACA,MAAI,MAAJ;AACA,MAAI,KAAJ;;AAEA,OAAK,QAAQ,KAAK,MAAlB,EAA0B,YAAY,KAAZ,GAAoB,KAA9C,EAAqD,YAAY,KAAZ,EAArD,EAA0E;AACxE,UAAM,KAAK,YAAY,KAAjB,CAAN;AACA,aAAS,YAAY,WAAZ,CAAwB,GAAxB,CAAT;;AAEA,QAAI,MAAJ,EAAY;AACV,kBAAY,cAAZ,CAA2B,GAA3B,IAAkC,MAAlC;AACD,KAFD,MAEO;AACL,aAAO,mBAAmB,GAAnB,EAAwB,WAAxB,CAAP;AACD;AACF;;AAED,SAAO,YAAY,QAAZ,EAAP;AACD;;AAED,SAAS,kBAAT,CAA4B,GAA5B,EAAiC,WAAjC,EAA8C;AAC5C,MAAI,OAAJ;;AAEA,MAAI,iBAAiB,GAAjB,CAAJ,EAA2B;AACzB,WAAO,gCAAgC,GAAhC,EAAqC,WAArC,EAAkD,UAAU,OAAV,EAAmB;AAC1E,kBAAY,KAAZ;AACA,kBAAY,cAAZ,CAA2B,GAA3B,IAAkC,OAAlC;AACA,aAAO,sBAAsB,WAAtB,CAAP;AACD,KAJM,CAAP;AAKD,GAND,MAMO;AACL,cAAU,+BAA+B,GAA/B,EAAoC,WAApC,CAAV;AACA,gBAAY,KAAZ;AACA,gBAAY,cAAZ,CAA2B,GAA3B,IAAkC,OAAlC;AACA,WAAO,sBAAsB,WAAtB,CAAP;AACD;AACF;;AAED,SAAS,+BAAT,CAAyC,GAAzC,EAA8C,WAA9C,EAA2D,UAA3D,EAAuE;AACrE,MAAI,YAAY,kBAAkB,GAAlB,EAAuB,IAAvB,EAA6B,YAAY,MAAzC,CAAhB;AACA,MAAI,oBAAoB,CAAC,YAAY,GAAZ,CAAzB;;AAEA,MAAI,YAAY,SAAhB,EAA2B;AACzB,gBAAY,QAAZ,CAAqB,IAArB,CAA0B,wCAAwC,GAAxC,GAA8C,yBAAxE;AACA,WAAO,WAAW,IAAX,CAAP;AACD,GAHD,MAGO,IAAI,iBAAJ,EAAuB;AAC5B,gBAAY,QAAZ,CAAqB,IAArB,CAA0B,mBAAmB,GAAnB,GAAyB,yBAAnD;AACA,WAAO,WAAW,IAAX,CAAP;AACD,GAHM,MAGA,IAAI,CAAC,SAAL,EAAgB;AACrB,gBAAY,QAAZ,CAAqB,IAArB,CAA0B,mBAAmB,GAAnB,GAAyB,+BAAnD;AACA,WAAO,WAAW,IAAX,CAAP;AACD;;AAED,cAAY,KAAZ,CAAkB,GAAlB,EAAuB,YAAY,aAAnC,EAAkD,YAAY,aAA9D,EAA6E,UAAU,KAAV,EAAiB,OAAjB,EAA0B;AACrG,QAAI,KAAJ,EAAW;AACT,kBAAY,QAAZ,CAAqB,IAArB,CAA0B,iCAAiC,GAAjC,GAAuC,MAAvC,GAAgD,KAA1E;AACD;;AAED,eAAW,OAAX;AACD,GAND;AAOD;;AAED,SAAS,8BAAT,CAAwC,WAAxC,EAAqD,WAArD,EAAkE;AAChE,MAAI,YAAY,kBAAkB,WAAlB,EAA+B,KAA/B,EAAsC,YAAY,MAAlD,CAAhB;AACA,MAAI,cAAc,KAAK,OAAL,CAAa,YAAY,QAAzB,EAAmC,WAAnC,CAAlB;;AAEA,MAAI,CAAC,GAAG,UAAH,CAAc,WAAd,CAAD,IAA+B,CAAC,GAAG,QAAH,CAAY,WAAZ,EAAyB,MAAzB,EAApC,EAAuE;AACrE,gBAAY,QAAZ,CAAqB,IAArB,CAA0B,mCAAmC,WAAnC,GAAiD,2BAA3E;AACA,WAAO,IAAP;AACD,GAHD,MAGO,IAAI,CAAC,SAAL,EAAgB;AACrB,gBAAY,QAAZ,CAAqB,IAArB,CAA0B,mBAAmB,WAAnB,GAAiC,+BAA3D;AACA,WAAO,IAAP;AACD;;AAED,SAAO,GAAG,YAAH,CAAgB,WAAhB,EAA6B,MAA7B,CAAP;AACD;;AAED,OAAO,OAAP,GAAiB,mBAAjB","file":"load-original-sources-compiled.js","sourcesContent":["var fs = require('fs');\nvar path = require('path');\n\nvar isAllowedResource = require('./is-allowed-resource');\n\nvar hasProtocol = require('../utils/has-protocol');\nvar isRemoteResource = require('../utils/is-remote-resource');\n\nfunction loadOriginalSources(context, callback) {\n  var loadContext = {\n    callback: callback,\n    fetch: context.options.fetch,\n    index: 0,\n    inline: context.options.inline,\n    inlineRequest: context.options.inlineRequest,\n    inlineTimeout: context.options.inlineTimeout,\n    localOnly: context.localOnly,\n    rebaseTo: context.options.rebaseTo,\n    sourcesContent: context.sourcesContent,\n    uriToSource: uriToSourceMapping(context.inputSourceMapTracker.all()),\n    warnings: context.warnings\n  };\n\n  return context.options.sourceMap && context.options.sourceMapInlineSources ?\n    doLoadOriginalSources(loadContext) :\n    callback();\n}\n\nfunction uriToSourceMapping(allSourceMapConsumers) {\n  var mapping = {};\n  var consumer;\n  var uri;\n  var source;\n  var i, l;\n\n  for (source in allSourceMapConsumers) {\n    consumer = allSourceMapConsumers[source];\n\n    for (i = 0, l = consumer.sources.length; i < l; i++) {\n      uri = consumer.sources[i];\n      source = consumer.sourceContentFor(uri, true);\n\n      mapping[uri] = source;\n    }\n  }\n\n  return mapping;\n}\n\nfunction doLoadOriginalSources(loadContext) {\n  var uris = Object.keys(loadContext.uriToSource);\n  var uri;\n  var source;\n  var total;\n\n  for (total = uris.length; loadContext.index < total; loadContext.index++) {\n    uri = uris[loadContext.index];\n    source = loadContext.uriToSource[uri];\n\n    if (source) {\n      loadContext.sourcesContent[uri] = source;\n    } else {\n      return loadOriginalSource(uri, loadContext);\n    }\n  }\n\n  return loadContext.callback();\n}\n\nfunction loadOriginalSource(uri, loadContext) {\n  var content;\n\n  if (isRemoteResource(uri)) {\n    return loadOriginalSourceFromRemoteUri(uri, loadContext, function (content) {\n      loadContext.index++;\n      loadContext.sourcesContent[uri] = content;\n      return doLoadOriginalSources(loadContext);\n    });\n  } else {\n    content = loadOriginalSourceFromLocalUri(uri, loadContext);\n    loadContext.index++;\n    loadContext.sourcesContent[uri] = content;\n    return doLoadOriginalSources(loadContext);\n  }\n}\n\nfunction loadOriginalSourceFromRemoteUri(uri, loadContext, whenLoaded) {\n  var isAllowed = isAllowedResource(uri, true, loadContext.inline);\n  var isRuntimeResource = !hasProtocol(uri);\n\n  if (loadContext.localOnly) {\n    loadContext.warnings.push('Cannot fetch remote resource from \"' + uri + '\" as no callback given.');\n    return whenLoaded(null);\n  } else if (isRuntimeResource) {\n    loadContext.warnings.push('Cannot fetch \"' + uri + '\" as no protocol given.');\n    return whenLoaded(null);\n  } else if (!isAllowed) {\n    loadContext.warnings.push('Cannot fetch \"' + uri + '\" as resource is not allowed.');\n    return whenLoaded(null);\n  }\n\n  loadContext.fetch(uri, loadContext.inlineRequest, loadContext.inlineTimeout, function (error, content) {\n    if (error) {\n      loadContext.warnings.push('Missing original source at \"' + uri + '\" - ' + error);\n    }\n\n    whenLoaded(content);\n  });\n}\n\nfunction loadOriginalSourceFromLocalUri(relativeUri, loadContext) {\n  var isAllowed = isAllowedResource(relativeUri, false, loadContext.inline);\n  var absoluteUri = path.resolve(loadContext.rebaseTo, relativeUri);\n\n  if (!fs.existsSync(absoluteUri) || !fs.statSync(absoluteUri).isFile()) {\n    loadContext.warnings.push('Ignoring local source map at \"' + absoluteUri + '\" as resource is missing.');\n    return null;\n  } else if (!isAllowed) {\n    loadContext.warnings.push('Cannot fetch \"' + absoluteUri + '\" as resource is not allowed.');\n    return null;\n  }\n\n  return fs.readFileSync(absoluteUri, 'utf8');\n}\n\nmodule.exports = loadOriginalSources;\n"]}