{"version":3,"sources":["apply-source-maps.js"],"names":[],"mappings":"AAAA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA,IAAI,oBAAoB,QAAQ,uBAAR,CAAxB;AACA,IAAI,eAAe,QAAQ,kBAAR,CAAnB;AACA,IAAI,iBAAiB,QAAQ,oBAAR,CAArB;AACA,IAAI,kBAAkB,QAAQ,qBAAR,CAAtB;;AAEA,IAAI,QAAQ,QAAQ,oBAAR,CAAZ;AACA,IAAI,cAAc,QAAQ,uBAAR,CAAlB;AACA,IAAI,oBAAoB,QAAQ,+BAAR,CAAxB;AACA,IAAI,mBAAmB,QAAQ,6BAAR,CAAvB;;AAEA,IAAI,qBAAqB,qCAAzB;;AAEA,SAAS,eAAT,CAAyB,MAAzB,EAAiC,OAAjC,EAA0C,QAA1C,EAAoD;AAClD,MAAI,eAAe;AACjB,cAAU,QADO;AAEjB,WAAO,QAAQ,OAAR,CAAgB,KAFN;AAGjB,WAAO,CAHU;AAIjB,YAAQ,QAAQ,OAAR,CAAgB,MAJP;AAKjB,mBAAe,QAAQ,OAAR,CAAgB,aALd;AAMjB,mBAAe,QAAQ,OAAR,CAAgB,aANd;AAOjB,2BAAuB,QAAQ,qBAPd;AAQjB,eAAW,QAAQ,SARF;AASjB,qBAAiB,EATA;AAUjB,cAAU,QAAQ,OAAR,CAAgB,QAVT;AAWjB,kBAAc,MAXG;AAYjB,cAAU,QAAQ;AAZD,GAAnB;;AAeA,SAAO,QAAQ,OAAR,CAAgB,SAAhB,IAA6B,OAAO,MAAP,GAAgB,CAA7C,GACL,kBAAkB,YAAlB,CADK,GAEL,SAAS,MAAT,CAFF;AAGD;;AAED,SAAS,iBAAT,CAA2B,YAA3B,EAAyC;AACvC,MAAI,qBAAqB,EAAzB;AACA,MAAI,aAAa,gBAAgB,aAAa,YAAb,CAA0B,CAA1B,CAAhB,CAAjB;AACA,MAAI,MAAJ;AACA,MAAI,KAAJ;AACA,MAAI,CAAJ;;AAEA,OAAK,IAAI,aAAa,YAAb,CAA0B,MAAnC,EAA2C,aAAa,KAAb,GAAqB,CAAhE,EAAmE,aAAa,KAAb,EAAnE,EAAyF;AACvF,YAAQ,aAAa,YAAb,CAA0B,aAAa,KAAvC,CAAR;AACA,aAAS,gBAAgB,KAAhB,CAAT;;AAEA,QAAI,UAAU,UAAd,EAA0B;AACxB,2BAAqB,EAArB;AACA,mBAAa,MAAb;AACD;;AAED,uBAAmB,IAAnB,CAAwB,KAAxB;AACA,iBAAa,eAAb,CAA6B,IAA7B,CAAkC,KAAlC;;AAEA,QAAI,MAAM,CAAN,KAAY,MAAM,OAAlB,IAA6B,mBAAmB,IAAnB,CAAwB,MAAM,CAAN,CAAxB,CAAjC,EAAoE;AAClE,aAAO,uBAAuB,MAAM,CAAN,CAAvB,EAAiC,MAAjC,EAAyC,kBAAzC,EAA6D,YAA7D,CAAP;AACD;AACF;;AAED,SAAO,aAAa,QAAb,CAAsB,aAAa,eAAnC,CAAP;AACD;;AAED,SAAS,eAAT,CAAyB,KAAzB,EAAgC;AAC9B,MAAI,KAAJ;AACA,MAAI,QAAJ;;AAEA,MAAI,MAAM,CAAN,KAAY,MAAM,OAAlB,IAA6B,MAAM,CAAN,KAAY,MAAM,OAAnD,EAA4D;AAC1D,eAAW,MAAM,CAAN,EAAS,CAAT,CAAX;AACD,GAFD,MAEO;AACL,YAAQ,MAAM,CAAN,EAAS,CAAT,CAAR;AACA,eAAW,MAAM,CAAN,EAAS,CAAT,CAAX;AACD;;AAED,SAAO,SAAS,CAAT,CAAP;AACD;;AAED,SAAS,sBAAT,CAAgC,gBAAhC,EAAkD,MAAlD,EAA0D,kBAA1D,EAA8E,YAA9E,EAA4F;AAC1F,SAAO,0BAA0B,gBAA1B,EAA4C,YAA5C,EAA0D,UAAU,cAAV,EAA0B;AACzF,QAAI,cAAJ,EAAoB;AAClB,mBAAa,qBAAb,CAAmC,KAAnC,CAAyC,MAAzC,EAAiD,cAAjD;AACA,gCAA0B,kBAA1B,EAA8C,aAAa,qBAA3D;AACD;;AAED,iBAAa,KAAb;AACA,WAAO,kBAAkB,YAAlB,CAAP;AACD,GARM,CAAP;AASD;;AAED,SAAS,yBAAT,CAAmC,gBAAnC,EAAqD,YAArD,EAAmE,kBAAnE,EAAuF;AACrF,MAAI,MAAM,mBAAmB,IAAnB,CAAwB,gBAAxB,EAA0C,CAA1C,CAAV;AACA,MAAI,WAAJ;AACA,MAAI,SAAJ;AACA,MAAI,UAAJ;;AAEA,MAAI,kBAAkB,GAAlB,CAAJ,EAA4B;AAC1B,gBAAY,iCAAiC,GAAjC,CAAZ;AACA,WAAO,mBAAmB,SAAnB,CAAP;AACD,GAHD,MAGO,IAAI,iBAAiB,GAAjB,CAAJ,EAA2B;AAChC,WAAO,gCAAgC,GAAhC,EAAqC,YAArC,EAAmD,UAAU,SAAV,EAAqB;AAC7E,UAAI,SAAJ;;AAEA,UAAI,SAAJ,EAAe;AACb,oBAAY,KAAK,KAAL,CAAW,SAAX,CAAZ;AACA,qBAAa,gBAAgB,SAAhB,EAA2B,GAA3B,CAAb;AACA,2BAAmB,UAAnB;AACD,OAJD,MAIO;AACL,2BAAmB,IAAnB;AACD;AACF,KAVM,CAAP;AAWD,GAZM,MAYA;AACL;AACA;AACA;AACA,kBAAc,KAAK,OAAL,CAAa,aAAa,QAA1B,EAAoC,GAApC,CAAd;AACA,gBAAY,+BAA+B,WAA/B,EAA4C,YAA5C,CAAZ;;AAEA,QAAI,SAAJ,EAAe;AACb,mBAAa,eAAe,SAAf,EAA0B,WAA1B,EAAuC,aAAa,QAApD,CAAb;AACA,aAAO,mBAAmB,UAAnB,CAAP;AACD,KAHD,MAGO;AACL,aAAO,mBAAmB,IAAnB,CAAP;AACD;AACF;AACF;;AAED,SAAS,gCAAT,CAA0C,GAA1C,EAA+C;AAC7C,MAAI,eAAe,aAAa,GAAb,CAAnB;AACA,MAAI,UAAU,aAAa,CAAb,IAAkB,aAAa,CAAb,EAAgB,KAAhB,CAAsB,MAAtB,EAA8B,CAA9B,CAAlB,GAAqD,UAAnE;AACA,MAAI,WAAW,aAAa,CAAb,IAAkB,aAAa,CAAb,EAAgB,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAlB,GAAkD,MAAjE;AACA,MAAI,OAAO,YAAY,MAAZ,GAAqB,OAAO,QAAP,CAAgB,aAAa,CAAb,CAAhB,CAArB,GAAwD,aAAa,CAAb,CAAnE;;AAEA,MAAI,SAAS,IAAI,MAAJ,CAAW,IAAX,EAAiB,QAAjB,CAAb;AACA,SAAO,OAAP,GAAiB,OAAjB;;AAEA,SAAO,KAAK,KAAL,CAAW,OAAO,QAAP,EAAX,CAAP;AACD;;AAED,SAAS,+BAAT,CAAyC,GAAzC,EAA8C,YAA9C,EAA4D,UAA5D,EAAwE;AACtE,MAAI,YAAY,kBAAkB,GAAlB,EAAuB,IAAvB,EAA6B,aAAa,MAA1C,CAAhB;AACA,MAAI,oBAAoB,CAAC,YAAY,GAAZ,CAAzB;;AAEA,MAAI,aAAa,SAAjB,EAA4B;AAC1B,iBAAa,QAAb,CAAsB,IAAtB,CAA2B,wCAAwC,GAAxC,GAA8C,yBAAzE;AACA,WAAO,WAAW,IAAX,CAAP;AACD,GAHD,MAGO,IAAI,iBAAJ,EAAuB;AAC5B,iBAAa,QAAb,CAAsB,IAAtB,CAA2B,mBAAmB,GAAnB,GAAyB,yBAApD;AACA,WAAO,WAAW,IAAX,CAAP;AACD,GAHM,MAGA,IAAI,CAAC,SAAL,EAAgB;AACrB,iBAAa,QAAb,CAAsB,IAAtB,CAA2B,mBAAmB,GAAnB,GAAyB,+BAApD;AACA,WAAO,WAAW,IAAX,CAAP;AACD;;AAED,eAAa,KAAb,CAAmB,GAAnB,EAAwB,aAAa,aAArC,EAAoD,aAAa,aAAjE,EAAgF,UAAU,KAAV,EAAiB,IAAjB,EAAuB;AACrG,QAAI,KAAJ,EAAW;AACT,mBAAa,QAAb,CAAsB,IAAtB,CAA2B,4BAA4B,GAA5B,GAAkC,MAAlC,GAA2C,KAAtE;AACA,aAAO,WAAW,IAAX,CAAP;AACD;;AAED,eAAW,IAAX;AACD,GAPD;AAQD;;AAED,SAAS,8BAAT,CAAwC,GAAxC,EAA6C,YAA7C,EAA2D;AACzD,MAAI,YAAY,kBAAkB,GAAlB,EAAuB,KAAvB,EAA8B,aAAa,MAA3C,CAAhB;AACA,MAAI,SAAJ;;AAEA,MAAI,CAAC,GAAG,UAAH,CAAc,GAAd,CAAD,IAAuB,CAAC,GAAG,QAAH,CAAY,GAAZ,EAAiB,MAAjB,EAA5B,EAAuD;AACrD,iBAAa,QAAb,CAAsB,IAAtB,CAA2B,mCAAmC,GAAnC,GAAyC,2BAApE;AACA,WAAO,IAAP;AACD,GAHD,MAGO,IAAI,CAAC,SAAL,EAAgB;AACrB,iBAAa,QAAb,CAAsB,IAAtB,CAA2B,mBAAmB,GAAnB,GAAyB,+BAApD;AACA,WAAO,IAAP;AACD;;AAED,cAAY,GAAG,YAAH,CAAgB,GAAhB,EAAqB,OAArB,CAAZ;AACA,SAAO,KAAK,KAAL,CAAW,SAAX,CAAP;AACD;;AAED,SAAS,yBAAT,CAAmC,MAAnC,EAA2C,qBAA3C,EAAkE;AAChE,MAAI,KAAJ;AACA,MAAI,CAAJ,EAAO,CAAP;;AAEA,OAAK,IAAI,CAAJ,EAAO,IAAI,OAAO,MAAvB,EAA+B,IAAI,CAAnC,EAAsC,GAAtC,EAA2C;AACzC,YAAQ,OAAO,CAAP,CAAR;;AAEA,YAAQ,MAAM,CAAN,CAAR;AACE,WAAK,MAAM,OAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,aAAX;AACE,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA;AACF,WAAK,MAAM,mBAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,YAAX;AACE,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA;AACF,WAAK,MAAM,kBAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,OAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,QAAX;AACE,kCAA0B,KAA1B,EAAiC,qBAAjC;AACA;AACF,WAAK,MAAM,cAAX;AACE,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA;AACF,WAAK,MAAM,aAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,cAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AACA;AACF,WAAK,MAAM,IAAX;AACE,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA,kCAA0B,MAAM,CAAN,CAA1B,EAAoC,qBAApC;AACA;AACF,WAAK,MAAM,UAAX;AACE,yBAAiB,KAAjB,EAAwB,qBAAxB;AAtCJ;AAwCD;;AAED,SAAO,MAAP;AACD;;AAED,SAAS,gBAAT,CAA0B,KAA1B,EAAiC,qBAAjC,EAAwD;AACtD,MAAI,QAAQ,MAAM,CAAN,CAAZ;AACA,MAAI,WAAW,MAAM,CAAN,CAAf;AACA,MAAI,cAAc,EAAlB;AACA,MAAI,CAAJ,EAAO,CAAP;;AAEA,OAAK,IAAI,CAAJ,EAAO,IAAI,SAAS,MAAzB,EAAiC,IAAI,CAArC,EAAwC,GAAxC,EAA6C;AAC3C,gBAAY,IAAZ,CAAiB,sBAAsB,mBAAtB,CAA0C,SAAS,CAAT,CAA1C,EAAuD,MAAM,MAA7D,CAAjB;AACD;;AAED,QAAM,CAAN,IAAW,WAAX;AACD;;AAED,OAAO,OAAP,GAAiB,eAAjB","file":"apply-source-maps-compiled.js","sourcesContent":["var fs = require('fs');\nvar path = require('path');\n\nvar isAllowedResource = require('./is-allowed-resource');\nvar matchDataUri = require('./match-data-uri');\nvar rebaseLocalMap = require('./rebase-local-map');\nvar rebaseRemoteMap = require('./rebase-remote-map');\n\nvar Token = require('../tokenizer/token');\nvar hasProtocol = require('../utils/has-protocol');\nvar isDataUriResource = require('../utils/is-data-uri-resource');\nvar isRemoteResource = require('../utils/is-remote-resource');\n\nvar MAP_MARKER_PATTERN = /^\\/\\*# sourceMappingURL=(\\S+) \\*\\/$/;\n\nfunction applySourceMaps(tokens, context, callback) {\n  var applyContext = {\n    callback: callback,\n    fetch: context.options.fetch,\n    index: 0,\n    inline: context.options.inline,\n    inlineRequest: context.options.inlineRequest,\n    inlineTimeout: context.options.inlineTimeout,\n    inputSourceMapTracker: context.inputSourceMapTracker,\n    localOnly: context.localOnly,\n    processedTokens: [],\n    rebaseTo: context.options.rebaseTo,\n    sourceTokens: tokens,\n    warnings: context.warnings\n  };\n\n  return context.options.sourceMap && tokens.length > 0 ?\n    doApplySourceMaps(applyContext) :\n    callback(tokens);\n}\n\nfunction doApplySourceMaps(applyContext) {\n  var singleSourceTokens = [];\n  var lastSource = findTokenSource(applyContext.sourceTokens[0]);\n  var source;\n  var token;\n  var l;\n\n  for (l = applyContext.sourceTokens.length; applyContext.index < l; applyContext.index++) {\n    token = applyContext.sourceTokens[applyContext.index];\n    source = findTokenSource(token);\n\n    if (source != lastSource) {\n      singleSourceTokens = [];\n      lastSource = source;\n    }\n\n    singleSourceTokens.push(token);\n    applyContext.processedTokens.push(token);\n\n    if (token[0] == Token.COMMENT && MAP_MARKER_PATTERN.test(token[1])) {\n      return fetchAndApplySourceMap(token[1], source, singleSourceTokens, applyContext);\n    }\n  }\n\n  return applyContext.callback(applyContext.processedTokens);\n}\n\nfunction findTokenSource(token) {\n  var scope;\n  var metadata;\n\n  if (token[0] == Token.AT_RULE || token[0] == Token.COMMENT) {\n    metadata = token[2][0];\n  } else {\n    scope = token[1][0];\n    metadata = scope[2][0];\n  }\n\n  return metadata[2];\n}\n\nfunction fetchAndApplySourceMap(sourceMapComment, source, singleSourceTokens, applyContext) {\n  return extractInputSourceMapFrom(sourceMapComment, applyContext, function (inputSourceMap) {\n    if (inputSourceMap) {\n      applyContext.inputSourceMapTracker.track(source, inputSourceMap);\n      applySourceMapRecursively(singleSourceTokens, applyContext.inputSourceMapTracker);\n    }\n\n    applyContext.index++;\n    return doApplySourceMaps(applyContext);\n  });\n}\n\nfunction extractInputSourceMapFrom(sourceMapComment, applyContext, whenSourceMapReady) {\n  var uri = MAP_MARKER_PATTERN.exec(sourceMapComment)[1];\n  var absoluteUri;\n  var sourceMap;\n  var rebasedMap;\n\n  if (isDataUriResource(uri)) {\n    sourceMap = extractInputSourceMapFromDataUri(uri);\n    return whenSourceMapReady(sourceMap);\n  } else if (isRemoteResource(uri)) {\n    return loadInputSourceMapFromRemoteUri(uri, applyContext, function (sourceMap) {\n      var parsedMap;\n\n      if (sourceMap) {\n        parsedMap = JSON.parse(sourceMap);\n        rebasedMap = rebaseRemoteMap(parsedMap, uri);\n        whenSourceMapReady(rebasedMap);\n      } else {\n        whenSourceMapReady(null);\n      }\n    });\n  } else {\n    // at this point `uri` is already rebased, see lib/reader/rebase.js#rebaseSourceMapComment\n    // it is rebased to be consistent with rebasing other URIs\n    // however here we need to resolve it back to read it from disk\n    absoluteUri = path.resolve(applyContext.rebaseTo, uri);\n    sourceMap = loadInputSourceMapFromLocalUri(absoluteUri, applyContext);\n\n    if (sourceMap) {\n      rebasedMap = rebaseLocalMap(sourceMap, absoluteUri, applyContext.rebaseTo);\n      return whenSourceMapReady(rebasedMap);\n    } else {\n      return whenSourceMapReady(null);\n    }\n  }\n}\n\nfunction extractInputSourceMapFromDataUri(uri) {\n  var dataUriMatch = matchDataUri(uri);\n  var charset = dataUriMatch[2] ? dataUriMatch[2].split(/[=;]/)[2] : 'us-ascii';\n  var encoding = dataUriMatch[3] ? dataUriMatch[3].split(';')[1] : 'utf8';\n  var data = encoding == 'utf8' ? global.unescape(dataUriMatch[4]) : dataUriMatch[4];\n\n  var buffer = new Buffer(data, encoding);\n  buffer.charset = charset;\n\n  return JSON.parse(buffer.toString());\n}\n\nfunction loadInputSourceMapFromRemoteUri(uri, applyContext, whenLoaded) {\n  var isAllowed = isAllowedResource(uri, true, applyContext.inline);\n  var isRuntimeResource = !hasProtocol(uri);\n\n  if (applyContext.localOnly) {\n    applyContext.warnings.push('Cannot fetch remote resource from \"' + uri + '\" as no callback given.');\n    return whenLoaded(null);\n  } else if (isRuntimeResource) {\n    applyContext.warnings.push('Cannot fetch \"' + uri + '\" as no protocol given.');\n    return whenLoaded(null);\n  } else if (!isAllowed) {\n    applyContext.warnings.push('Cannot fetch \"' + uri + '\" as resource is not allowed.');\n    return whenLoaded(null);\n  }\n\n  applyContext.fetch(uri, applyContext.inlineRequest, applyContext.inlineTimeout, function (error, body) {\n    if (error) {\n      applyContext.warnings.push('Missing source map at \"' + uri + '\" - ' + error);\n      return whenLoaded(null);\n    }\n\n    whenLoaded(body);\n  });\n}\n\nfunction loadInputSourceMapFromLocalUri(uri, applyContext) {\n  var isAllowed = isAllowedResource(uri, false, applyContext.inline);\n  var sourceMap;\n\n  if (!fs.existsSync(uri) || !fs.statSync(uri).isFile()) {\n    applyContext.warnings.push('Ignoring local source map at \"' + uri + '\" as resource is missing.');\n    return null;\n  } else if (!isAllowed) {\n    applyContext.warnings.push('Cannot fetch \"' + uri + '\" as resource is not allowed.');\n    return null;\n  }\n\n  sourceMap = fs.readFileSync(uri, 'utf-8');\n  return JSON.parse(sourceMap);\n}\n\nfunction applySourceMapRecursively(tokens, inputSourceMapTracker) {\n  var token;\n  var i, l;\n\n  for (i = 0, l = tokens.length; i < l; i++) {\n    token = tokens[i];\n\n    switch (token[0]) {\n      case Token.AT_RULE:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.AT_RULE_BLOCK:\n        applySourceMapRecursively(token[1], inputSourceMapTracker);\n        applySourceMapRecursively(token[2], inputSourceMapTracker);\n        break;\n      case Token.AT_RULE_BLOCK_SCOPE:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.NESTED_BLOCK:\n        applySourceMapRecursively(token[1], inputSourceMapTracker);\n        applySourceMapRecursively(token[2], inputSourceMapTracker);\n        break;\n      case Token.NESTED_BLOCK_SCOPE:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.COMMENT:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.PROPERTY:\n        applySourceMapRecursively(token, inputSourceMapTracker);\n        break;\n      case Token.PROPERTY_BLOCK:\n        applySourceMapRecursively(token[1], inputSourceMapTracker);\n        break;\n      case Token.PROPERTY_NAME:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.PROPERTY_VALUE:\n        applySourceMapTo(token, inputSourceMapTracker);\n        break;\n      case Token.RULE:\n        applySourceMapRecursively(token[1], inputSourceMapTracker);\n        applySourceMapRecursively(token[2], inputSourceMapTracker);\n        break;\n      case Token.RULE_SCOPE:\n        applySourceMapTo(token, inputSourceMapTracker);\n    }\n  }\n\n  return tokens;\n}\n\nfunction applySourceMapTo(token, inputSourceMapTracker) {\n  var value = token[1];\n  var metadata = token[2];\n  var newMetadata = [];\n  var i, l;\n\n  for (i = 0, l = metadata.length; i < l; i++) {\n    newMetadata.push(inputSourceMapTracker.originalPositionFor(metadata[i], value.length));\n  }\n\n  token[2] = newMetadata;\n}\n\nmodule.exports = applySourceMaps;\n"]}