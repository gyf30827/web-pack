{"version":3,"sources":["merge-media-queries.js"],"names":[],"mappings":"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","file":"merge-media-queries-compiled.js","sourcesContent":["var canReorder = require('./reorderable').canReorder;\nvar canReorderSingle = require('./reorderable').canReorderSingle;\nvar extractProperties = require('./extract-properties');\nvar rulesOverlap = require('./rules-overlap');\n\nvar serializeRules = require('../../writer/one-time').rules;\nvar OptimizationLevel = require('../../options/optimization-level').OptimizationLevel;\nvar Token = require('../../tokenizer/token');\n\nfunction mergeMediaQueries(tokens, context) {\n  var mergeSemantically = context.options.level[OptimizationLevel.Two].mergeSemantically;\n  var specificityCache = context.cache.specificity;\n  var candidates = {};\n  var reduced = [];\n\n  for (var i = tokens.length - 1; i >= 0; i--) {\n    var token = tokens[i];\n    if (token[0] != Token.NESTED_BLOCK) {\n      continue;\n    }\n\n    var key = serializeRules(token[1]);\n    var candidate = candidates[key];\n    if (!candidate) {\n      candidate = [];\n      candidates[key] = candidate;\n    }\n\n    candidate.push(i);\n  }\n\n  for (var name in candidates) {\n    var positions = candidates[name];\n\n    positionLoop:\n    for (var j = positions.length - 1; j > 0; j--) {\n      var positionOne = positions[j];\n      var tokenOne = tokens[positionOne];\n      var positionTwo = positions[j - 1];\n      var tokenTwo = tokens[positionTwo];\n\n      directionLoop:\n      for (var direction = 1; direction >= -1; direction -= 2) {\n        var topToBottom = direction == 1;\n        var from = topToBottom ? positionOne + 1 : positionTwo - 1;\n        var to = topToBottom ? positionTwo : positionOne;\n        var delta = topToBottom ? 1 : -1;\n        var source = topToBottom ? tokenOne : tokenTwo;\n        var target = topToBottom ? tokenTwo : tokenOne;\n        var movedProperties = extractProperties(source);\n\n        while (from != to) {\n          var traversedProperties = extractProperties(tokens[from]);\n          from += delta;\n\n          if (mergeSemantically && allSameRulePropertiesCanBeReordered(movedProperties, traversedProperties, specificityCache)) {\n            continue;\n          }\n\n          if (!canReorder(movedProperties, traversedProperties, specificityCache))\n            continue directionLoop;\n        }\n\n        target[2] = topToBottom ?\n          source[2].concat(target[2]) :\n          target[2].concat(source[2]);\n        source[2] = [];\n\n        reduced.push(target);\n        continue positionLoop;\n      }\n    }\n  }\n\n  return reduced;\n}\n\nfunction allSameRulePropertiesCanBeReordered(movedProperties, traversedProperties, specificityCache) {\n  var movedProperty;\n  var movedRule;\n  var traversedProperty;\n  var traversedRule;\n  var i, l;\n  var j, m;\n\n  for (i = 0, l = movedProperties.length; i < l; i++) {\n    movedProperty = movedProperties[i];\n    movedRule = movedProperty[5];\n\n    for (j = 0, m = traversedProperties.length; j < m; j++) {\n      traversedProperty = traversedProperties[j];\n      traversedRule = traversedProperty[5];\n\n      if (rulesOverlap(movedRule, traversedRule, true) && !canReorderSingle(movedProperty, traversedProperty, specificityCache)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nmodule.exports = mergeMediaQueries;\n"]}