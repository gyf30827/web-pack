{"version":3,"sources":["remove-unused-at-rules.js"],"names":[],"mappings":"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","file":"remove-unused-at-rules-compiled.js","sourcesContent":["var populateComponents = require('./properties/populate-components');\n\nvar wrapForOptimizing = require('../wrap-for-optimizing').single;\nvar restoreFromOptimizing = require('../restore-from-optimizing');\n\nvar Token = require('../../tokenizer/token');\n\nvar animationNameRegex = /^(\\-moz\\-|\\-o\\-|\\-webkit\\-)?animation-name$/;\nvar animationRegex = /^(\\-moz\\-|\\-o\\-|\\-webkit\\-)?animation$/;\nvar keyframeRegex = /^@(\\-moz\\-|\\-o\\-|\\-webkit\\-)?keyframes /;\nvar optionalMatchingQuotesRegex = /^(['\"]?)(.*)\\1$/;\n\nfunction removeQuotes(value) {\n  return value.replace(optionalMatchingQuotesRegex, '$2');\n}\n\nfunction removeUnusedAtRules(tokens, context) {\n  removeUnusedAtRule(tokens, matchCounterStyle, markCounterStylesAsUsed, context);\n  removeUnusedAtRule(tokens, matchFontFace, markFontFacesAsUsed, context);\n  removeUnusedAtRule(tokens, matchKeyframe, markKeyframesAsUsed, context);\n  removeUnusedAtRule(tokens, matchNamespace, markNamespacesAsUsed, context);\n}\n\nfunction removeUnusedAtRule(tokens, matchCallback, markCallback, context) {\n  var atRules = {};\n  var atRule;\n  var atRuleTokens;\n  var atRuleToken;\n  var zeroAt;\n  var i, l;\n\n  for (i = 0, l = tokens.length; i < l; i++) {\n    matchCallback(tokens[i], atRules);\n  }\n\n  if (Object.keys(atRules).length === 0) {\n    return;\n  }\n\n  markUsedAtRules(tokens, markCallback, atRules, context);\n\n  for (atRule in atRules) {\n    atRuleTokens = atRules[atRule];\n\n    for (i = 0, l = atRuleTokens.length; i < l; i++) {\n      atRuleToken = atRuleTokens[i];\n      zeroAt = atRuleToken[0] == Token.AT_RULE ? 1 : 2;\n      atRuleToken[zeroAt] = [];\n    }\n  }\n}\n\nfunction markUsedAtRules(tokens, markCallback, atRules, context) {\n  var boundMarkCallback = markCallback(atRules);\n  var i, l;\n\n  for (i = 0, l = tokens.length; i < l; i++) {\n    switch (tokens[i][0]) {\n      case Token.RULE:\n        boundMarkCallback(tokens[i], context);\n        break;\n      case Token.NESTED_BLOCK:\n        markUsedAtRules(tokens[i][2], markCallback, atRules, context);\n    }\n  }\n}\n\nfunction matchCounterStyle(token, atRules) {\n  var match;\n\n  if (token[0] == Token.AT_RULE_BLOCK && token[1][0][1].indexOf('@counter-style') === 0) {\n    match = token[1][0][1].split(' ')[1];\n    atRules[match] = atRules[match] || [];\n    atRules[match].push(token);\n  }\n}\n\nfunction markCounterStylesAsUsed(atRules) {\n  return function (token, context) {\n    var property;\n    var wrappedProperty;\n    var i, l;\n\n    for (i = 0, l = token[2].length; i < l; i++) {\n      property = token[2][i];\n\n      if (property[1][1] == 'list-style') {\n        wrappedProperty = wrapForOptimizing(property);\n        populateComponents([wrappedProperty], context.validator, context.warnings);\n\n        if (wrappedProperty.components[0].value[0][1] in atRules) {\n          delete atRules[property[2][1]];\n        }\n\n        restoreFromOptimizing([wrappedProperty]);\n      }\n\n      if (property[1][1] == 'list-style-type' && property[2][1] in atRules) {\n        delete atRules[property[2][1]];\n      }\n    }\n  };\n}\n\nfunction matchFontFace(token, atRules) {\n  var property;\n  var match;\n  var i, l;\n\n  if (token[0] == Token.AT_RULE_BLOCK && token[1][0][1] == '@font-face') {\n    for (i = 0, l = token[2].length; i < l; i++) {\n      property = token[2][i];\n\n      if (property[1][1] == 'font-family') {\n        match = removeQuotes(property[2][1].toLowerCase());\n        atRules[match] = atRules[match] || [];\n        atRules[match].push(token);\n        break;\n      }\n    }\n  }\n}\n\nfunction markFontFacesAsUsed(atRules) {\n  return function (token, context) {\n    var property;\n    var wrappedProperty;\n    var component;\n    var normalizedMatch;\n    var i, l;\n    var j, m;\n\n    for (i = 0, l = token[2].length; i < l; i++) {\n      property = token[2][i];\n\n      if (property[1][1] == 'font') {\n        wrappedProperty = wrapForOptimizing(property);\n        populateComponents([wrappedProperty], context.validator, context.warnings);\n        component = wrappedProperty.components[6];\n\n        for (j = 0, m = component.value.length; j < m; j++) {\n          normalizedMatch = removeQuotes(component.value[j][1].toLowerCase());\n\n          if (normalizedMatch in atRules) {\n            delete atRules[normalizedMatch];\n          }\n        }\n\n        restoreFromOptimizing([wrappedProperty]);\n      }\n\n      if (property[1][1] == 'font-family') {\n        for (j = 2, m = property.length; j < m; j++) {\n          normalizedMatch = removeQuotes(property[j][1].toLowerCase());\n\n          if (normalizedMatch in atRules) {\n            delete atRules[normalizedMatch];\n          }\n        }\n      }\n    }\n  };\n}\n\nfunction matchKeyframe(token, atRules) {\n  var match;\n\n  if (token[0] == Token.NESTED_BLOCK && keyframeRegex.test(token[1][0][1])) {\n    match = token[1][0][1].split(' ')[1];\n    atRules[match] = atRules[match] || [];\n    atRules[match].push(token);\n  }\n}\n\nfunction markKeyframesAsUsed(atRules) {\n  return function (token, context) {\n    var property;\n    var wrappedProperty;\n    var component;\n    var i, l;\n    var j, m;\n\n    for (i = 0, l = token[2].length; i < l; i++) {\n      property = token[2][i];\n\n      if (animationRegex.test(property[1][1])) {\n        wrappedProperty = wrapForOptimizing(property);\n        populateComponents([wrappedProperty], context.validator, context.warnings);\n        component = wrappedProperty.components[7];\n\n        for (j = 0, m = component.value.length; j < m; j++) {\n          if (component.value[j][1] in atRules) {\n            delete atRules[component.value[j][1]];\n          }\n        }\n\n        restoreFromOptimizing([wrappedProperty]);\n      }\n\n      if (animationNameRegex.test(property[1][1])) {\n        for (j = 2, m = property.length; j < m; j++) {\n          if (property[j][1] in atRules) {\n            delete atRules[property[j][1]];\n          }\n        }\n      }\n    }\n  };\n}\n\nfunction matchNamespace(token, atRules) {\n  var match;\n\n  if (token[0] == Token.AT_RULE && token[1].indexOf('@namespace') === 0) {\n    match = token[1].split(' ')[1];\n    atRules[match] = atRules[match] || [];\n    atRules[match].push(token);\n  }\n}\n\nfunction markNamespacesAsUsed(atRules) {\n  var namespaceRegex = new RegExp(Object.keys(atRules).join('\\\\\\||') + '\\\\\\|', 'g');\n\n  return function (token) {\n    var match;\n    var scope;\n    var normalizedMatch;\n    var i, l;\n    var j, m;\n\n    for (i = 0, l = token[1].length; i < l; i++) {\n      scope = token[1][i];\n      match = scope[1].match(namespaceRegex);\n\n      for (j = 0, m = match.length; j < m; j++) {\n        normalizedMatch = match[j].substring(0, match[j].length - 1);\n\n        if (normalizedMatch in atRules) {\n          delete atRules[normalizedMatch];\n        }\n      }\n    }\n  };\n}\n\nmodule.exports = removeUnusedAtRules;\n"]}