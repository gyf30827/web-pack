{"version":3,"sources":["is-mergeable.js"],"names":[],"mappings":"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","file":"is-mergeable-compiled.js","sourcesContent":["var Marker = require('../../tokenizer/marker');\nvar split = require('../../utils/split');\n\nvar DEEP_SELECTOR_PATTERN = /\\/deep\\//;\nvar DOUBLE_COLON_PATTERN = /^::/;\nvar NOT_PSEUDO = ':not';\nvar PSEUDO_CLASSES_WITH_ARGUMENTS = [\n  ':dir',\n  ':lang',\n  ':not',\n  ':nth-child',\n  ':nth-last-child',\n  ':nth-last-of-type',\n  ':nth-of-type'\n];\nvar RELATION_PATTERN = /[>\\+~]/;\nvar UNMIXABLE_PSEUDO_CLASSES = [\n  ':after',\n  ':before',\n  ':first-letter',\n  ':first-line',\n  ':lang'\n];\nvar UNMIXABLE_PSEUDO_ELEMENTS = [\n  '::after',\n  '::before',\n  '::first-letter',\n  '::first-line'\n];\n\nvar Level = {\n  DOUBLE_QUOTE: 'double-quote',\n  SINGLE_QUOTE: 'single-quote',\n  ROOT: 'root'\n};\n\nfunction isMergeable(selector, mergeablePseudoClasses, mergeablePseudoElements, multiplePseudoMerging) {\n  var singleSelectors = split(selector, Marker.COMMA);\n  var singleSelector;\n  var i, l;\n\n  for (i = 0, l = singleSelectors.length; i < l; i++) {\n    singleSelector = singleSelectors[i];\n\n    if (singleSelector.length === 0 ||\n        isDeepSelector(singleSelector) ||\n        (singleSelector.indexOf(Marker.COLON) > -1 && !areMergeable(singleSelector, extractPseudoFrom(singleSelector), mergeablePseudoClasses, mergeablePseudoElements, multiplePseudoMerging))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction isDeepSelector(selector) {\n  return DEEP_SELECTOR_PATTERN.test(selector);\n}\n\nfunction extractPseudoFrom(selector) {\n  var list = [];\n  var character;\n  var buffer = [];\n  var level = Level.ROOT;\n  var roundBracketLevel = 0;\n  var isQuoted;\n  var isEscaped;\n  var isPseudo = false;\n  var isRelation;\n  var wasColon = false;\n  var index;\n  var len;\n\n  for (index = 0, len = selector.length; index < len; index++) {\n    character = selector[index];\n\n    isRelation = !isEscaped && RELATION_PATTERN.test(character);\n    isQuoted = level == Level.DOUBLE_QUOTE || level == Level.SINGLE_QUOTE;\n\n    if (isEscaped) {\n      buffer.push(character);\n    } else if (character == Marker.DOUBLE_QUOTE && level == Level.ROOT) {\n      buffer.push(character);\n      level = Level.DOUBLE_QUOTE;\n    } else if (character == Marker.DOUBLE_QUOTE && level == Level.DOUBLE_QUOTE) {\n      buffer.push(character);\n      level = Level.ROOT;\n    } else if (character == Marker.SINGLE_QUOTE && level == Level.ROOT) {\n      buffer.push(character);\n      level = Level.SINGLE_QUOTE;\n    } else if (character == Marker.SINGLE_QUOTE && level == Level.SINGLE_QUOTE) {\n      buffer.push(character);\n      level = Level.ROOT;\n    } else if (isQuoted) {\n      buffer.push(character);\n    } else if (character == Marker.OPEN_ROUND_BRACKET) {\n      buffer.push(character);\n      roundBracketLevel++;\n    } else if (character == Marker.CLOSE_ROUND_BRACKET && roundBracketLevel == 1 && isPseudo) {\n      buffer.push(character);\n      list.push(buffer.join(''));\n      roundBracketLevel--;\n      buffer = [];\n      isPseudo = false;\n    } else if (character == Marker.CLOSE_ROUND_BRACKET) {\n      buffer.push(character);\n      roundBracketLevel--;\n    } else if (character == Marker.COLON && roundBracketLevel === 0 && isPseudo && !wasColon) {\n      list.push(buffer.join(''));\n      buffer = [];\n      buffer.push(character);\n    } else if (character == Marker.COLON && roundBracketLevel === 0 && !wasColon) {\n      buffer = [];\n      buffer.push(character);\n      isPseudo = true;\n    } else if (character == Marker.SPACE && roundBracketLevel === 0 && isPseudo) {\n      list.push(buffer.join(''));\n      buffer = [];\n      isPseudo = false;\n    } else if (isRelation && roundBracketLevel === 0 && isPseudo) {\n      list.push(buffer.join(''));\n      buffer = [];\n      isPseudo = false;\n    } else {\n      buffer.push(character);\n    }\n\n    isEscaped = character == Marker.BACK_SLASH;\n    wasColon = character == Marker.COLON;\n  }\n\n  if (buffer.length > 0 && isPseudo) {\n    list.push(buffer.join(''));\n  }\n\n  return list;\n}\n\nfunction areMergeable(selector, matches, mergeablePseudoClasses, mergeablePseudoElements, multiplePseudoMerging) {\n  return areAllowed(matches, mergeablePseudoClasses, mergeablePseudoElements) &&\n    needArguments(matches) &&\n    (matches.length < 2 || !someIncorrectlyChained(selector, matches)) &&\n    (matches.length < 2 || multiplePseudoMerging && allMixable(matches));\n}\n\nfunction areAllowed(matches, mergeablePseudoClasses, mergeablePseudoElements) {\n  var match;\n  var name;\n  var i, l;\n\n  for (i = 0, l = matches.length; i < l; i++) {\n    match = matches[i];\n    name = match.indexOf(Marker.OPEN_ROUND_BRACKET) > -1 ?\n      match.substring(0, match.indexOf(Marker.OPEN_ROUND_BRACKET)) :\n      match;\n\n    if (mergeablePseudoClasses.indexOf(name) === -1 && mergeablePseudoElements.indexOf(name) === -1) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction needArguments(matches) {\n  var match;\n  var name;\n  var bracketOpensAt;\n  var hasArguments;\n  var i, l;\n\n  for (i = 0, l = matches.length; i < l; i++) {\n    match = matches[i];\n\n    bracketOpensAt = match.indexOf(Marker.OPEN_ROUND_BRACKET);\n    hasArguments = bracketOpensAt > -1;\n    name = hasArguments ?\n      match.substring(0, bracketOpensAt) :\n      match;\n\n    if (hasArguments && PSEUDO_CLASSES_WITH_ARGUMENTS.indexOf(name) == -1) {\n      return false;\n    }\n\n    if (!hasArguments && PSEUDO_CLASSES_WITH_ARGUMENTS.indexOf(name) > -1) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction someIncorrectlyChained(selector, matches) {\n  var positionInSelector = 0;\n  var match;\n  var matchAt;\n  var nextMatch;\n  var nextMatchAt;\n  var name;\n  var nextName;\n  var areChained;\n  var i, l;\n\n  for (i = 0, l = matches.length; i < l; i++) {\n    match = matches[i];\n    nextMatch = matches[i + 1];\n\n    if (!nextMatch) {\n      break;\n    }\n\n    matchAt = selector.indexOf(match, positionInSelector);\n    nextMatchAt = selector.indexOf(match, matchAt + 1);\n    positionInSelector = nextMatchAt;\n    areChained = matchAt + match.length == nextMatchAt;\n\n    if (areChained) {\n      name = match.indexOf(Marker.OPEN_ROUND_BRACKET) > -1 ?\n        match.substring(0, match.indexOf(Marker.OPEN_ROUND_BRACKET)) :\n        match;\n      nextName = nextMatch.indexOf(Marker.OPEN_ROUND_BRACKET) > -1 ?\n        nextMatch.substring(0, nextMatch.indexOf(Marker.OPEN_ROUND_BRACKET)) :\n        nextMatch;\n\n      if (name != NOT_PSEUDO || nextName != NOT_PSEUDO) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nfunction allMixable(matches) {\n  var unmixableMatches = 0;\n  var match;\n  var i, l;\n\n  for (i = 0, l = matches.length; i < l; i++) {\n    match = matches[i];\n\n    if (isPseudoElement(match)) {\n      unmixableMatches += UNMIXABLE_PSEUDO_ELEMENTS.indexOf(match) > -1 ? 1 : 0;\n    } else {\n      unmixableMatches += UNMIXABLE_PSEUDO_CLASSES.indexOf(match) > -1 ? 1 : 0;\n    }\n\n    if (unmixableMatches > 1) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction isPseudoElement(pseudo) {\n  return DOUBLE_COLON_PATTERN.test(pseudo);\n}\n\nmodule.exports = isMergeable;\n"]}